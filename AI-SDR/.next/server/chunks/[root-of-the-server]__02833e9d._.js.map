{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 61, "column": 0}, "map": {"version":3,"sources":["file:///Users/suyashmankar/Desktop/LYZR/Jazon%20-%20AI%20SDR/AI-SDR-APP/AI-SDR/src/lib/mongodb.ts"],"sourcesContent":["import mongoose from 'mongoose';\n\n/**\n * Global is used here to maintain a cached connection across hot reloads\n * in development. This prevents connections growing exponentially\n * during API Route usage.\n */\ndeclare global {\n  var mongoose: {\n    conn: typeof mongoose | null;\n    promise: Promise<typeof mongoose> | null;\n  };\n}\n\nlet cached = global.mongoose;\n\nif (!cached) {\n  cached = global.mongoose = { conn: null, promise: null };\n}\n\nasync function connectDB() {\n  let MONGODB_URI = process.env.MONGODB_URI;\n\n  if (!MONGODB_URI) {\n    throw new Error(\n      'Please define the MONGODB_URI environment variable inside .env.local'\n    );\n  }\n\n  // Remove quotes if present\n  MONGODB_URI = MONGODB_URI.replace(/^[\"']|[\"']$/g, '');\n\n  // If we have a cached connection, return it\n  if (cached.conn) {\n    return cached.conn;\n  }\n\n  // If we don't have a cached promise, create one\n  if (!cached.promise) {\n    const opts = {\n      bufferCommands: false,\n    };\n\n    cached.promise = mongoose.connect(MONGODB_URI, opts).then(async (mongoose) => {\n      console.log('‚úÖ MongoDB connected successfully');\n      \n      // Ensure models are registered (Next.js hot reload fix)\n      // Dynamically import models to ensure they're registered after connection\n      if (!mongoose.models.Company) {\n        await import('@/models/Company');\n      }\n      if (!mongoose.models.Persona) {\n        await import('@/models/Persona');\n      }\n      if (!mongoose.models.Lead) {\n        await import('@/models/Lead');\n      }\n      \n      return mongoose;\n    });\n  }\n\n  try {\n    cached.conn = await cached.promise;\n  } catch (e) {\n    cached.promise = null;\n    throw e;\n  }\n\n  return cached.conn;\n}\n\nexport default connectDB;\n\n"],"names":[],"mappings":";;;;AAAA;;AAcA,IAAI,SAAS,OAAO,QAAQ;AAE5B,IAAI,CAAC,QAAQ;IACX,SAAS,OAAO,QAAQ,GAAG;QAAE,MAAM;QAAM,SAAS;IAAK;AACzD;AAEA,eAAe;IACb,IAAI,cAAc,QAAQ,GAAG,CAAC,WAAW;IAEzC,IAAI,CAAC,aAAa;QAChB,MAAM,IAAI,MACR;IAEJ;IAEA,2BAA2B;IAC3B,cAAc,YAAY,OAAO,CAAC,gBAAgB;IAElD,4CAA4C;IAC5C,IAAI,OAAO,IAAI,EAAE;QACf,OAAO,OAAO,IAAI;IACpB;IAEA,gDAAgD;IAChD,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,MAAM,OAAO;YACX,gBAAgB;QAClB;QAEA,OAAO,OAAO,GAAG,oHAAQ,CAAC,OAAO,CAAC,aAAa,MAAM,IAAI,CAAC,OAAO;YAC/D,QAAQ,GAAG,CAAC;YAEZ,wDAAwD;YACxD,0EAA0E;YAC1E,IAAI,CAAC,SAAS,MAAM,CAAC,OAAO,EAAE;gBAC5B;YACF;YACA,IAAI,CAAC,SAAS,MAAM,CAAC,OAAO,EAAE;gBAC5B;YACF;YACA,IAAI,CAAC,SAAS,MAAM,CAAC,IAAI,EAAE;gBACzB;YACF;YAEA,OAAO;QACT;IACF;IAEA,IAAI;QACF,OAAO,IAAI,GAAG,MAAM,OAAO,OAAO;IACpC,EAAE,OAAO,GAAG;QACV,OAAO,OAAO,GAAG;QACjB,MAAM;IACR;IAEA,OAAO,OAAO,IAAI;AACpB;uCAEe","debugId":null}},
    {"offset": {"line": 119, "column": 0}, "map": {"version":3,"sources":["file:///Users/suyashmankar/Desktop/LYZR/Jazon%20-%20AI%20SDR/AI-SDR-APP/AI-SDR/src/models/Lead.ts"],"sourcesContent":["import mongoose, { Document, Model, Schema } from \"mongoose\";\n\nexport interface ISourceMetadata {\n  apollo_list_name?: string;\n  apollo_person_id?: string;\n  hubspot_contact_id?: string;\n  salesforce_lead_id?: string;\n}\n\nexport type LeadStatus = \"uploaded\" | \"researched\" | \"icp_scored\";\n\nexport interface ILead extends Document {\n  name: string;\n  title: string;\n  email?: string;\n  company_id: mongoose.Types.ObjectId;\n  persona_id: mongoose.Types.ObjectId;\n  status: LeadStatus;\n  source: string;\n  source_metadata?: ISourceMetadata;\n  createdAt: Date;\n  updatedAt: Date;\n}\n\nconst SourceMetadataSchema = new Schema<ISourceMetadata>(\n  {\n    apollo_list_name: { type: String },\n    apollo_person_id: { type: String },\n    hubspot_contact_id: { type: String },\n    salesforce_lead_id: { type: String },\n  },\n  { _id: false }\n);\n\nconst LeadSchema = new Schema<ILead>(\n  {\n    name: {\n      type: String,\n      required: true,\n    },\n    title: {\n      type: String,\n      required: true,\n    },\n    email: {\n      type: String,\n      required: false,\n    },\n    company_id: {\n      type: Schema.Types.ObjectId,\n      ref: \"Company\",\n      required: true,\n      index: true,\n    },\n    persona_id: {\n      type: Schema.Types.ObjectId,\n      ref: \"Persona\",\n      required: true,\n      index: true,\n    },\n    status: {\n      type: String,\n      enum: [\"uploaded\", \"researched\", \"icp_scored\"],\n      required: true,\n      default: \"uploaded\",\n      index: true,\n    },\n    source: {\n      type: String,\n      default: \"CSV\",\n    },\n    source_metadata: {\n      type: SourceMetadataSchema,\n      required: false,\n    },\n  },\n  {\n    timestamps: true,\n    collection: \"leads\",\n  }\n);\n\n// Indexes for common queries\nLeadSchema.index({ company_id: 1, persona_id: 1 });\nLeadSchema.index({ status: 1, createdAt: -1 });\n\nconst Lead: Model<ILead> =\n  mongoose.models.Lead || mongoose.model<ILead>(\"Lead\", LeadSchema);\n\nexport default Lead;\n"],"names":[],"mappings":";;;;AAAA;;AAwBA,MAAM,uBAAuB,IAAI,mHAAM,CACrC;IACE,kBAAkB;QAAE,MAAM;IAAO;IACjC,kBAAkB;QAAE,MAAM;IAAO;IACjC,oBAAoB;QAAE,MAAM;IAAO;IACnC,oBAAoB;QAAE,MAAM;IAAO;AACrC,GACA;IAAE,KAAK;AAAM;AAGf,MAAM,aAAa,IAAI,mHAAM,CAC3B;IACE,MAAM;QACJ,MAAM;QACN,UAAU;IACZ;IACA,OAAO;QACL,MAAM;QACN,UAAU;IACZ;IACA,OAAO;QACL,MAAM;QACN,UAAU;IACZ;IACA,YAAY;QACV,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;QACV,OAAO;IACT;IACA,YAAY;QACV,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;QACV,OAAO;IACT;IACA,QAAQ;QACN,MAAM;QACN,MAAM;YAAC;YAAY;YAAc;SAAa;QAC9C,UAAU;QACV,SAAS;QACT,OAAO;IACT;IACA,QAAQ;QACN,MAAM;QACN,SAAS;IACX;IACA,iBAAiB;QACf,MAAM;QACN,UAAU;IACZ;AACF,GACA;IACE,YAAY;IACZ,YAAY;AACd;AAGF,6BAA6B;AAC7B,WAAW,KAAK,CAAC;IAAE,YAAY;IAAG,YAAY;AAAE;AAChD,WAAW,KAAK,CAAC;IAAE,QAAQ;IAAG,WAAW,CAAC;AAAE;AAE5C,MAAM,OACJ,oHAAQ,CAAC,MAAM,CAAC,IAAI,IAAI,oHAAQ,CAAC,KAAK,CAAQ,QAAQ;uCAEzC","debugId":null}},
    {"offset": {"line": 204, "column": 0}, "map": {"version":3,"sources":["file:///Users/suyashmankar/Desktop/LYZR/Jazon%20-%20AI%20SDR/AI-SDR-APP/AI-SDR/src/models/ICPScore.ts"],"sourcesContent":["import mongoose, { Document, Model, Schema } from \"mongoose\";\n\nexport interface IScoreBreakdown {\n  company_fit: number;\n  persona_fit: number;\n  timing_fit: number;\n}\n\nexport interface IScoringMeta {\n  inputs_used: string[];\n  scored_at: string;\n}\n\nexport interface IICPScore extends Document {\n  lead_id: mongoose.Types.ObjectId;\n  icp_score: number;\n  fit_tier: \"Tier 1\" | \"Tier 2\" | \"Tier 3\" | \"Disqualified\";\n  score_breakdown: IScoreBreakdown;\n  strengths: string[];\n  risks: string[];\n  gaps: string[];\n  confidence_level: \"High\" | \"Medium\" | \"Low\";\n  scoring_meta: IScoringMeta;\n  createdAt: Date;\n  updatedAt: Date;\n}\n\nconst ScoreBreakdownSchema = new Schema<IScoreBreakdown>(\n  {\n    company_fit: { type: Number, default: 0 },\n    persona_fit: { type: Number, default: 0 },\n    timing_fit: { type: Number, default: 0 },\n  },\n  { _id: false }\n);\n\nconst ScoringMetaSchema = new Schema<IScoringMeta>(\n  {\n    inputs_used: { type: [String], default: [] },\n    scored_at: { type: String, default: \"\" },\n  },\n  { _id: false }\n);\n\nconst ICPScoreSchema = new Schema<IICPScore>(\n  {\n    lead_id: {\n      type: Schema.Types.ObjectId,\n      ref: \"Lead\",\n      required: true,\n      unique: true,\n      index: true,\n    },\n    icp_score: {\n      type: Number,\n      required: true,\n      min: 0,\n      max: 100,\n      index: true,\n    },\n    fit_tier: {\n      type: String,\n      enum: [\"Tier 1\", \"Tier 2\", \"Tier 3\", \"Disqualified\"],\n      required: true,\n      index: true,\n    },\n    score_breakdown: {\n      type: ScoreBreakdownSchema,\n      default: () => ({}),\n    },\n    strengths: {\n      type: [String],\n      default: [],\n    },\n    risks: {\n      type: [String],\n      default: [],\n    },\n    gaps: {\n      type: [String],\n      default: [],\n    },\n    confidence_level: {\n      type: String,\n      enum: [\"High\", \"Medium\", \"Low\"],\n      default: \"Low\",\n    },\n    scoring_meta: {\n      type: ScoringMetaSchema,\n      default: () => ({}),\n    },\n  },\n  {\n    timestamps: true,\n    collection: \"icp_scores\",\n  }\n);\n\nconst ICPScore: Model<IICPScore> =\n  mongoose.models.ICPScore ||\n  mongoose.model<IICPScore>(\"ICPScore\", ICPScoreSchema);\n\nexport default ICPScore;\n\n"],"names":[],"mappings":";;;;AAAA;;AA2BA,MAAM,uBAAuB,IAAI,mHAAM,CACrC;IACE,aAAa;QAAE,MAAM;QAAQ,SAAS;IAAE;IACxC,aAAa;QAAE,MAAM;QAAQ,SAAS;IAAE;IACxC,YAAY;QAAE,MAAM;QAAQ,SAAS;IAAE;AACzC,GACA;IAAE,KAAK;AAAM;AAGf,MAAM,oBAAoB,IAAI,mHAAM,CAClC;IACE,aAAa;QAAE,MAAM;YAAC;SAAO;QAAE,SAAS,EAAE;IAAC;IAC3C,WAAW;QAAE,MAAM;QAAQ,SAAS;IAAG;AACzC,GACA;IAAE,KAAK;AAAM;AAGf,MAAM,iBAAiB,IAAI,mHAAM,CAC/B;IACE,SAAS;QACP,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;QACV,QAAQ;QACR,OAAO;IACT;IACA,WAAW;QACT,MAAM;QACN,UAAU;QACV,KAAK;QACL,KAAK;QACL,OAAO;IACT;IACA,UAAU;QACR,MAAM;QACN,MAAM;YAAC;YAAU;YAAU;YAAU;SAAe;QACpD,UAAU;QACV,OAAO;IACT;IACA,iBAAiB;QACf,MAAM;QACN,SAAS,IAAM,CAAC,CAAC,CAAC;IACpB;IACA,WAAW;QACT,MAAM;YAAC;SAAO;QACd,SAAS,EAAE;IACb;IACA,OAAO;QACL,MAAM;YAAC;SAAO;QACd,SAAS,EAAE;IACb;IACA,MAAM;QACJ,MAAM;YAAC;SAAO;QACd,SAAS,EAAE;IACb;IACA,kBAAkB;QAChB,MAAM;QACN,MAAM;YAAC;YAAQ;YAAU;SAAM;QAC/B,SAAS;IACX;IACA,cAAc;QACZ,MAAM;QACN,SAAS,IAAM,CAAC,CAAC,CAAC;IACpB;AACF,GACA;IACE,YAAY;IACZ,YAAY;AACd;AAGF,MAAM,WACJ,oHAAQ,CAAC,MAAM,CAAC,QAAQ,IACxB,oHAAQ,CAAC,KAAK,CAAY,YAAY;uCAEzB","debugId":null}},
    {"offset": {"line": 311, "column": 0}, "map": {"version":3,"sources":["file:///Users/suyashmankar/Desktop/LYZR/Jazon%20-%20AI%20SDR/AI-SDR-APP/AI-SDR/src/models/OutreachCampaign.ts"],"sourcesContent":["import mongoose, { Document, Model, Schema } from \"mongoose\";\n\nexport interface IOutreachCampaign extends Document {\n  lead_id: mongoose.Types.ObjectId;\n  status:\n    | \"not_started\"\n    | \"active\"\n    | \"paused\"\n    | \"stopped\"\n    | \"completed\"\n    | \"disqualified\";\n  current_phase: \"Research\" | \"Engagement\" | \"Qualification\" | \"Handoff\";\n  current_step_number: number;\n  next_planned_action: {\n    label: string;\n    scheduled_at: Date | null;\n  };\n  final_decision: {\n    status: string;\n    reason: string;\n  };\n  channel_mix: {\n    email: number;\n    linkedin: number;\n    voice: number;\n  };\n  response_rate: number;\n  avg_response_time: number;\n  createdAt: Date;\n  updatedAt: Date;\n}\n\nconst OutreachCampaignSchema = new Schema<IOutreachCampaign>(\n  {\n    lead_id: {\n      type: Schema.Types.ObjectId,\n      ref: \"Lead\",\n      required: true,\n      unique: true,\n      index: true,\n    },\n    status: {\n      type: String,\n      enum: [\n        \"not_started\",\n        \"active\",\n        \"paused\",\n        \"stopped\",\n        \"completed\",\n        \"disqualified\",\n      ],\n      default: \"not_started\",\n    },\n    current_phase: {\n      type: String,\n      enum: [\"Research\", \"Engagement\", \"Qualification\", \"Handoff\"],\n      default: \"Research\",\n    },\n    current_step_number: {\n      type: Number,\n      default: 0,\n    },\n    next_planned_action: {\n      label: {\n        type: String,\n        default: \"Generate outreach strategy\",\n      },\n      scheduled_at: {\n        type: Date,\n        default: null,\n      },\n    },\n    final_decision: {\n      status: {\n        type: String,\n        default: \"Pending\",\n      },\n      reason: {\n        type: String,\n        default: \"Outreach not yet generated\",\n      },\n    },\n    channel_mix: {\n      email: {\n        type: Number,\n        default: 0,\n      },\n      linkedin: {\n        type: Number,\n        default: 0,\n      },\n      voice: {\n        type: Number,\n        default: 0,\n      },\n    },\n    response_rate: {\n      type: Number,\n      default: 0,\n    },\n    avg_response_time: {\n      type: Number,\n      default: 0,\n    },\n  },\n  {\n    timestamps: true,\n    collection: \"outreach_campaigns\",\n  }\n);\n\nconst OutreachCampaign: Model<IOutreachCampaign> =\n  mongoose.models.OutreachCampaign ||\n  mongoose.model<IOutreachCampaign>(\"OutreachCampaign\", OutreachCampaignSchema);\n\nexport default OutreachCampaign;\n\n"],"names":[],"mappings":";;;;AAAA;;AAgCA,MAAM,yBAAyB,IAAI,mHAAM,CACvC;IACE,SAAS;QACP,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;QACV,QAAQ;QACR,OAAO;IACT;IACA,QAAQ;QACN,MAAM;QACN,MAAM;YACJ;YACA;YACA;YACA;YACA;YACA;SACD;QACD,SAAS;IACX;IACA,eAAe;QACb,MAAM;QACN,MAAM;YAAC;YAAY;YAAc;YAAiB;SAAU;QAC5D,SAAS;IACX;IACA,qBAAqB;QACnB,MAAM;QACN,SAAS;IACX;IACA,qBAAqB;QACnB,OAAO;YACL,MAAM;YACN,SAAS;QACX;QACA,cAAc;YACZ,MAAM;YACN,SAAS;QACX;IACF;IACA,gBAAgB;QACd,QAAQ;YACN,MAAM;YACN,SAAS;QACX;QACA,QAAQ;YACN,MAAM;YACN,SAAS;QACX;IACF;IACA,aAAa;QACX,OAAO;YACL,MAAM;YACN,SAAS;QACX;QACA,UAAU;YACR,MAAM;YACN,SAAS;QACX;QACA,OAAO;YACL,MAAM;YACN,SAAS;QACX;IACF;IACA,eAAe;QACb,MAAM;QACN,SAAS;IACX;IACA,mBAAmB;QACjB,MAAM;QACN,SAAS;IACX;AACF,GACA;IACE,YAAY;IACZ,YAAY;AACd;AAGF,MAAM,mBACJ,oHAAQ,CAAC,MAAM,CAAC,gBAAgB,IAChC,oHAAQ,CAAC,KAAK,CAAoB,oBAAoB;uCAEzC","debugId":null}},
    {"offset": {"line": 403, "column": 0}, "map": {"version":3,"sources":["file:///Users/suyashmankar/Desktop/LYZR/Jazon%20-%20AI%20SDR/AI-SDR-APP/AI-SDR/src/models/OutreachStrategyRun.ts"],"sourcesContent":["import mongoose, { Document, Model, Schema } from \"mongoose\";\n\nexport interface IOutreachStrategyRun extends Document {\n  lead_id: mongoose.Types.ObjectId;\n  research_run_id: mongoose.Types.ObjectId;\n  icp_score_id: mongoose.Types.ObjectId;\n  strategy_output: {\n    strategy_status: string;\n    strategy_meta: {\n      generated_at: Date;\n      model: string;\n      inputs_used: {\n        research_run_id: string;\n        icp_score_id: string;\n      };\n    };\n    plan_summary: string;\n    target_persona: {\n      title: string;\n      seniority: string;\n      department: string;\n    };\n    recommended_channel_sequence: Array<{\n      step: number;\n      channel: string;\n      intent: string;\n      goal: string;\n      reasoning: string;\n      recommended_delay_hours: number;\n      send_window: string;\n      personalization_signals: string[];\n      content_request: string;\n      gating_conditions: string[];\n    }>;\n    voice_readiness: {\n      thresholds: {\n        icp_min: number;\n        engagement_channels_min: number;\n      };\n      human_approval_required: boolean;\n      rationale: string;\n    };\n    sequencing_logic: {\n      rationale: string;\n      recommended_delays: string;\n    };\n    risk_flags: string[];\n    confidence_level: string;\n  };\n  createdAt: Date;\n  updatedAt: Date;\n}\n\nconst OutreachStrategyRunSchema = new Schema<IOutreachStrategyRun>(\n  {\n    lead_id: {\n      type: Schema.Types.ObjectId,\n      ref: \"Lead\",\n      required: true,\n      index: true,\n    },\n    research_run_id: {\n      type: Schema.Types.ObjectId,\n      ref: \"ResearchRun\",\n      required: true,\n    },\n    icp_score_id: {\n      type: Schema.Types.ObjectId,\n      ref: \"ICPScore\",\n      required: true,\n    },\n    strategy_output: {\n      type: Schema.Types.Mixed,\n      required: true,\n    },\n  },\n  {\n    timestamps: true,\n    collection: \"outreach_strategy_runs\",\n  }\n);\n\n// Index for finding latest strategy run per lead\nOutreachStrategyRunSchema.index({ lead_id: 1, createdAt: -1 });\n\nconst OutreachStrategyRun: Model<IOutreachStrategyRun> =\n  mongoose.models.OutreachStrategyRun ||\n  mongoose.model<IOutreachStrategyRun>(\n    \"OutreachStrategyRun\",\n    OutreachStrategyRunSchema\n  );\n\nexport default OutreachStrategyRun;\n\n"],"names":[],"mappings":";;;;AAAA;;AAqDA,MAAM,4BAA4B,IAAI,mHAAM,CAC1C;IACE,SAAS;QACP,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;QACV,OAAO;IACT;IACA,iBAAiB;QACf,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;IACZ;IACA,cAAc;QACZ,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;IACZ;IACA,iBAAiB;QACf,MAAM,mHAAM,CAAC,KAAK,CAAC,KAAK;QACxB,UAAU;IACZ;AACF,GACA;IACE,YAAY;IACZ,YAAY;AACd;AAGF,iDAAiD;AACjD,0BAA0B,KAAK,CAAC;IAAE,SAAS;IAAG,WAAW,CAAC;AAAE;AAE5D,MAAM,sBACJ,oHAAQ,CAAC,MAAM,CAAC,mBAAmB,IACnC,oHAAQ,CAAC,KAAK,CACZ,uBACA;uCAGW","debugId":null}},
    {"offset": {"line": 445, "column": 0}, "map": {"version":3,"sources":["file:///Users/suyashmankar/Desktop/LYZR/Jazon%20-%20AI%20SDR/AI-SDR-APP/AI-SDR/src/models/OutreachCopyRun.ts"],"sourcesContent":["import mongoose, { Document, Model, Schema } from \"mongoose\";\n\nexport interface IOutreachCopyRun extends Document {\n  lead_id: mongoose.Types.ObjectId;\n  strategy_run_id: mongoose.Types.ObjectId;\n  copy_output: {\n    status: string;\n    channel: string;\n    copy_meta: {\n      generated_at: Date;\n      model: string;\n      strategy_run_id: string;\n    };\n    drafts: Array<{\n      step: number;\n      channel: string;\n      subject_options: string[];\n      body: string;\n      talking_points: string[];\n      personalization_used: string[];\n      strategy_alignment: string;\n    }>;\n    confidence_level: string;\n    review_notes: string[];\n  };\n  createdAt: Date;\n  updatedAt: Date;\n}\n\nconst OutreachCopyRunSchema = new Schema<IOutreachCopyRun>(\n  {\n    lead_id: {\n      type: Schema.Types.ObjectId,\n      ref: \"Lead\",\n      required: true,\n      index: true,\n    },\n    strategy_run_id: {\n      type: Schema.Types.ObjectId,\n      ref: \"OutreachStrategyRun\",\n      required: true,\n    },\n    copy_output: {\n      type: Schema.Types.Mixed,\n      required: true,\n    },\n  },\n  {\n    timestamps: true,\n    collection: \"outreach_copy_runs\",\n  }\n);\n\n// Index for finding latest copy run per lead\nOutreachCopyRunSchema.index({ lead_id: 1, createdAt: -1 });\n\nconst OutreachCopyRun: Model<IOutreachCopyRun> =\n  mongoose.models.OutreachCopyRun ||\n  mongoose.model<IOutreachCopyRun>(\"OutreachCopyRun\", OutreachCopyRunSchema);\n\nexport default OutreachCopyRun;\n\n"],"names":[],"mappings":";;;;AAAA;;AA6BA,MAAM,wBAAwB,IAAI,mHAAM,CACtC;IACE,SAAS;QACP,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;QACV,OAAO;IACT;IACA,iBAAiB;QACf,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;IACZ;IACA,aAAa;QACX,MAAM,mHAAM,CAAC,KAAK,CAAC,KAAK;QACxB,UAAU;IACZ;AACF,GACA;IACE,YAAY;IACZ,YAAY;AACd;AAGF,6CAA6C;AAC7C,sBAAsB,KAAK,CAAC;IAAE,SAAS;IAAG,WAAW,CAAC;AAAE;AAExD,MAAM,kBACJ,oHAAQ,CAAC,MAAM,CAAC,eAAe,IAC/B,oHAAQ,CAAC,KAAK,CAAmB,mBAAmB;uCAEvC","debugId":null}},
    {"offset": {"line": 482, "column": 0}, "map": {"version":3,"sources":["file:///Users/suyashmankar/Desktop/LYZR/Jazon%20-%20AI%20SDR/AI-SDR-APP/AI-SDR/src/models/OutreachEvent.ts"],"sourcesContent":["import mongoose, { Document, Model, Schema } from \"mongoose\";\n\nexport type OutreachEventType =\n  | \"lifecycle\"\n  | \"research\"\n  | \"outreach\"\n  | \"engagement\"\n  | \"decision\"\n  | \"guardrail\"\n  | \"outcome\";\n\nexport type OutreachEventActor = \"AI\" | \"System\" | \"Human\";\n\nexport interface IOutreachEvent extends Document {\n  lead_id: mongoose.Types.ObjectId;\n  campaign_id: mongoose.Types.ObjectId;\n  event_type: OutreachEventType;\n  actor: OutreachEventActor;\n  timestamp: Date;\n  sort_order: number;\n  title: string;\n  summary: string;\n  badge: string;\n  channel?: string;\n  direction?: \"inbound\" | \"outbound\";\n  content?: {\n    subject?: string;\n    body?: string;\n    talking_points?: string[];\n  };\n  metadata: Record<string, any>;\n  createdAt: Date;\n}\n\nconst OutreachEventSchema = new Schema<IOutreachEvent>(\n  {\n    lead_id: {\n      type: Schema.Types.ObjectId,\n      ref: \"Lead\",\n      required: true,\n      index: true,\n    },\n    campaign_id: {\n      type: Schema.Types.ObjectId,\n      ref: \"OutreachCampaign\",\n      required: true,\n      index: true,\n    },\n    event_type: {\n      type: String,\n      enum: [\n        \"lifecycle\",\n        \"research\",\n        \"outreach\",\n        \"engagement\",\n        \"decision\",\n        \"guardrail\",\n        \"outcome\",\n      ],\n      required: true,\n    },\n    actor: {\n      type: String,\n      enum: [\"AI\", \"System\", \"Human\"],\n      required: true,\n    },\n    timestamp: {\n      type: Date,\n      required: true,\n      index: true,\n    },\n    sort_order: {\n      type: Number,\n      required: true,\n    },\n    title: {\n      type: String,\n      required: true,\n    },\n    summary: {\n      type: String,\n      required: true,\n    },\n    badge: {\n      type: String,\n      default: \"\",\n    },\n    channel: {\n      type: String,\n      default: \"\",\n    },\n    direction: {\n      type: String,\n      enum: [\"inbound\", \"outbound\", \"\"],\n      default: \"\",\n    },\n    content: {\n      subject: String,\n      body: String,\n      talking_points: [String],\n    },\n    metadata: {\n      type: Schema.Types.Mixed,\n      default: {},\n    },\n  },\n  {\n    timestamps: true,\n    collection: \"outreach_events\",\n  }\n);\n\n// Compound index for chronological queries\nOutreachEventSchema.index({ lead_id: 1, sort_order: 1 });\nOutreachEventSchema.index({ campaign_id: 1, timestamp: 1 });\n\nconst OutreachEvent: Model<IOutreachEvent> =\n  mongoose.models.OutreachEvent ||\n  mongoose.model<IOutreachEvent>(\"OutreachEvent\", OutreachEventSchema);\n\nexport default OutreachEvent;\n\n"],"names":[],"mappings":";;;;AAAA;;AAkCA,MAAM,sBAAsB,IAAI,mHAAM,CACpC;IACE,SAAS;QACP,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;QACV,OAAO;IACT;IACA,aAAa;QACX,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;QACV,OAAO;IACT;IACA,YAAY;QACV,MAAM;QACN,MAAM;YACJ;YACA;YACA;YACA;YACA;YACA;YACA;SACD;QACD,UAAU;IACZ;IACA,OAAO;QACL,MAAM;QACN,MAAM;YAAC;YAAM;YAAU;SAAQ;QAC/B,UAAU;IACZ;IACA,WAAW;QACT,MAAM;QACN,UAAU;QACV,OAAO;IACT;IACA,YAAY;QACV,MAAM;QACN,UAAU;IACZ;IACA,OAAO;QACL,MAAM;QACN,UAAU;IACZ;IACA,SAAS;QACP,MAAM;QACN,UAAU;IACZ;IACA,OAAO;QACL,MAAM;QACN,SAAS;IACX;IACA,SAAS;QACP,MAAM;QACN,SAAS;IACX;IACA,WAAW;QACT,MAAM;QACN,MAAM;YAAC;YAAW;YAAY;SAAG;QACjC,SAAS;IACX;IACA,SAAS;QACP,SAAS;QACT,MAAM;QACN,gBAAgB;YAAC;SAAO;IAC1B;IACA,UAAU;QACR,MAAM,mHAAM,CAAC,KAAK,CAAC,KAAK;QACxB,SAAS,CAAC;IACZ;AACF,GACA;IACE,YAAY;IACZ,YAAY;AACd;AAGF,2CAA2C;AAC3C,oBAAoB,KAAK,CAAC;IAAE,SAAS;IAAG,YAAY;AAAE;AACtD,oBAAoB,KAAK,CAAC;IAAE,aAAa;IAAG,WAAW;AAAE;AAEzD,MAAM,gBACJ,oHAAQ,CAAC,MAAM,CAAC,aAAa,IAC7B,oHAAQ,CAAC,KAAK,CAAiB,iBAAiB;uCAEnC","debugId":null}},
    {"offset": {"line": 587, "column": 0}, "map": {"version":3,"sources":["file:///Users/suyashmankar/Desktop/LYZR/Jazon%20-%20AI%20SDR/AI-SDR-APP/AI-SDR/src/models/OutreachGuardrails.ts"],"sourcesContent":["import mongoose, { Document, Model, Schema } from \"mongoose\";\n\nexport interface IOutreachGuardrails extends Document {\n  lead_id: mongoose.Types.ObjectId | null; // null = global defaults\n  max_touches: number;\n  voice_escalation_allowed: boolean;\n  voice_escalation_trigger: string;\n  stop_conditions: string[];\n  compliance_rules: string[];\n  createdAt: Date;\n  updatedAt: Date;\n}\n\nconst OutreachGuardrailsSchema = new Schema<IOutreachGuardrails>(\n  {\n    lead_id: {\n      type: Schema.Types.ObjectId,\n      ref: \"Lead\",\n      default: null,\n      index: true,\n    },\n    max_touches: {\n      type: Number,\n      default: 8,\n    },\n    voice_escalation_allowed: {\n      type: Boolean,\n      default: true,\n    },\n    voice_escalation_trigger: {\n      type: String,\n      default: \"High ICP (‚â•80) + engagement on 2+ channels\",\n    },\n    stop_conditions: {\n      type: [String],\n      default: [\n        \"Explicit opt-out\",\n        \"No engagement after 8 touches\",\n        \"ICP score drops below 40 after re-research\",\n      ],\n    },\n    compliance_rules: {\n      type: [String],\n      default: [\n        \"No weekend outreach (respects business hours)\",\n        \"Unsubscribe links included in all emails\",\n        \"GDPR and CAN-SPAM compliant messaging\",\n      ],\n    },\n  },\n  {\n    timestamps: true,\n    collection: \"outreach_guardrails\",\n  }\n);\n\n// Static method to get guardrails (lead-specific or global)\nOutreachGuardrailsSchema.statics.getForLead = async function (\n  leadId: mongoose.Types.ObjectId\n) {\n  // Try to find lead-specific guardrails\n  let guardrails = await this.findOne({ lead_id: leadId });\n\n  if (!guardrails) {\n    // Fall back to global defaults\n    guardrails = await this.findOne({ lead_id: null });\n\n    if (!guardrails) {\n      // Create global defaults if they don't exist\n      guardrails = await this.create({ lead_id: null });\n    }\n  }\n\n  return guardrails;\n};\n\nconst OutreachGuardrails: Model<IOutreachGuardrails> =\n  mongoose.models.OutreachGuardrails ||\n  mongoose.model<IOutreachGuardrails>(\n    \"OutreachGuardrails\",\n    OutreachGuardrailsSchema\n  );\n\nexport default OutreachGuardrails;\n\n"],"names":[],"mappings":";;;;AAAA;;AAaA,MAAM,2BAA2B,IAAI,mHAAM,CACzC;IACE,SAAS;QACP,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,SAAS;QACT,OAAO;IACT;IACA,aAAa;QACX,MAAM;QACN,SAAS;IACX;IACA,0BAA0B;QACxB,MAAM;QACN,SAAS;IACX;IACA,0BAA0B;QACxB,MAAM;QACN,SAAS;IACX;IACA,iBAAiB;QACf,MAAM;YAAC;SAAO;QACd,SAAS;YACP;YACA;YACA;SACD;IACH;IACA,kBAAkB;QAChB,MAAM;YAAC;SAAO;QACd,SAAS;YACP;YACA;YACA;SACD;IACH;AACF,GACA;IACE,YAAY;IACZ,YAAY;AACd;AAGF,4DAA4D;AAC5D,yBAAyB,OAAO,CAAC,UAAU,GAAG,eAC5C,MAA+B;IAE/B,uCAAuC;IACvC,IAAI,aAAa,MAAM,IAAI,CAAC,OAAO,CAAC;QAAE,SAAS;IAAO;IAEtD,IAAI,CAAC,YAAY;QACf,+BAA+B;QAC/B,aAAa,MAAM,IAAI,CAAC,OAAO,CAAC;YAAE,SAAS;QAAK;QAEhD,IAAI,CAAC,YAAY;YACf,6CAA6C;YAC7C,aAAa,MAAM,IAAI,CAAC,MAAM,CAAC;gBAAE,SAAS;YAAK;QACjD;IACF;IAEA,OAAO;AACT;AAEA,MAAM,qBACJ,oHAAQ,CAAC,MAAM,CAAC,kBAAkB,IAClC,oHAAQ,CAAC,KAAK,CACZ,sBACA;uCAGW","debugId":null}},
    {"offset": {"line": 662, "column": 0}, "map": {"version":3,"sources":["file:///Users/suyashmankar/Desktop/LYZR/Jazon%20-%20AI%20SDR/AI-SDR-APP/AI-SDR/src/models/FieldOverride.ts"],"sourcesContent":["import mongoose, { Document, Model, Schema } from \"mongoose\";\n\nexport type OverrideScope =\n  | \"company\"\n  | \"persona\"\n  | \"outreach_campaign\"\n  | \"outreach_strategy\"\n  | \"outreach_copy\"\n  | \"outreach_guardrails\";\n\nexport interface IFieldOverride extends Document {\n  scope: OverrideScope;\n  entity_id: mongoose.Types.ObjectId;\n  path: string; // JSON path like \"steps[2].goal\" or \"maxTouches\"\n  value: any;\n  updated_by: string;\n  reason: string;\n  updatedAt: Date;\n}\n\nconst FieldOverrideSchema = new Schema<IFieldOverride>(\n  {\n    scope: {\n      type: String,\n      enum: [\n        \"company\",\n        \"persona\",\n        \"outreach_campaign\",\n        \"outreach_strategy\",\n        \"outreach_copy\",\n        \"outreach_guardrails\",\n      ],\n      required: true,\n      index: true,\n    },\n    entity_id: {\n      type: Schema.Types.ObjectId,\n      required: true,\n      index: true,\n    },\n    path: {\n      type: String,\n      required: true,\n    },\n    value: {\n      type: Schema.Types.Mixed,\n      required: true,\n    },\n    updated_by: {\n      type: String,\n      default: \"user\",\n    },\n    reason: {\n      type: String,\n      default: \"\",\n    },\n  },\n  {\n    timestamps: { createdAt: false, updatedAt: true },\n    collection: \"field_overrides\",\n  }\n);\n\n// Compound index for efficient lookups\nFieldOverrideSchema.index({ scope: 1, entity_id: 1, path: 1 }, { unique: true });\n\n// Static method to get all overrides for an entity\nFieldOverrideSchema.statics.getOverridesForEntity = async function (\n  scope: OverrideScope,\n  entityId: mongoose.Types.ObjectId\n) {\n  const overrides = await this.find({ scope, entity_id: entityId });\n  \n  // Convert to a map for easy lookup\n  const overrideMap: Record<string, any> = {};\n  overrides.forEach((override) => {\n    overrideMap[override.path] = override.value;\n  });\n  \n  return overrideMap;\n};\n\n// Static method to set an override\nFieldOverrideSchema.statics.setOverride = async function (\n  scope: OverrideScope,\n  entityId: mongoose.Types.ObjectId,\n  path: string,\n  value: any,\n  updatedBy: string = \"user\",\n  reason: string = \"\"\n) {\n  return await this.findOneAndUpdate(\n    { scope, entity_id: entityId, path },\n    { value, updated_by: updatedBy, reason },\n    { upsert: true, new: true }\n  );\n};\n\nconst FieldOverride: Model<IFieldOverride> =\n  mongoose.models.FieldOverride ||\n  mongoose.model<IFieldOverride>(\"FieldOverride\", FieldOverrideSchema);\n\nexport default FieldOverride;\n\n"],"names":[],"mappings":";;;;AAAA;;AAoBA,MAAM,sBAAsB,IAAI,mHAAM,CACpC;IACE,OAAO;QACL,MAAM;QACN,MAAM;YACJ;YACA;YACA;YACA;YACA;YACA;SACD;QACD,UAAU;QACV,OAAO;IACT;IACA,WAAW;QACT,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,UAAU;QACV,OAAO;IACT;IACA,MAAM;QACJ,MAAM;QACN,UAAU;IACZ;IACA,OAAO;QACL,MAAM,mHAAM,CAAC,KAAK,CAAC,KAAK;QACxB,UAAU;IACZ;IACA,YAAY;QACV,MAAM;QACN,SAAS;IACX;IACA,QAAQ;QACN,MAAM;QACN,SAAS;IACX;AACF,GACA;IACE,YAAY;QAAE,WAAW;QAAO,WAAW;IAAK;IAChD,YAAY;AACd;AAGF,uCAAuC;AACvC,oBAAoB,KAAK,CAAC;IAAE,OAAO;IAAG,WAAW;IAAG,MAAM;AAAE,GAAG;IAAE,QAAQ;AAAK;AAE9E,mDAAmD;AACnD,oBAAoB,OAAO,CAAC,qBAAqB,GAAG,eAClD,KAAoB,EACpB,QAAiC;IAEjC,MAAM,YAAY,MAAM,IAAI,CAAC,IAAI,CAAC;QAAE;QAAO,WAAW;IAAS;IAE/D,mCAAmC;IACnC,MAAM,cAAmC,CAAC;IAC1C,UAAU,OAAO,CAAC,CAAC;QACjB,WAAW,CAAC,SAAS,IAAI,CAAC,GAAG,SAAS,KAAK;IAC7C;IAEA,OAAO;AACT;AAEA,mCAAmC;AACnC,oBAAoB,OAAO,CAAC,WAAW,GAAG,eACxC,KAAoB,EACpB,QAAiC,EACjC,IAAY,EACZ,KAAU,EACV,YAAoB,MAAM,EAC1B,SAAiB,EAAE;IAEnB,OAAO,MAAM,IAAI,CAAC,gBAAgB,CAChC;QAAE;QAAO,WAAW;QAAU;IAAK,GACnC;QAAE;QAAO,YAAY;QAAW;IAAO,GACvC;QAAE,QAAQ;QAAM,KAAK;IAAK;AAE9B;AAEA,MAAM,gBACJ,oHAAQ,CAAC,MAAM,CAAC,aAAa,IAC7B,oHAAQ,CAAC,KAAK,CAAiB,iBAAiB;uCAEnC","debugId":null}},
    {"offset": {"line": 752, "column": 0}, "map": {"version":3,"sources":["file:///Users/suyashmankar/Desktop/LYZR/Jazon%20-%20AI%20SDR/AI-SDR-APP/AI-SDR/src/app/api/leads/%5Bid%5D/outreach/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport connectDB from \"@/lib/mongodb\";\nimport Lead from \"@/models/Lead\";\nimport Company from \"@/models/Company\";\nimport ICPScore from \"@/models/ICPScore\";\nimport OutreachCampaign from \"@/models/OutreachCampaign\";\nimport OutreachStrategyRun from \"@/models/OutreachStrategyRun\";\nimport OutreachCopyRun from \"@/models/OutreachCopyRun\";\nimport OutreachEvent from \"@/models/OutreachEvent\";\nimport OutreachGuardrails from \"@/models/OutreachGuardrails\";\nimport FieldOverride from \"@/models/FieldOverride\";\n\nexport const runtime = \"nodejs\";\n\ninterface RouteParams {\n  params: Promise<{ id: string }>;\n}\n\n// Helper to merge overrides into an object\nfunction applyOverrides(\n  baseObject: any,\n  overrides: Record<string, any>\n): any {\n  const result = JSON.parse(JSON.stringify(baseObject)); // Deep clone\n  \n  for (const [path, value] of Object.entries(overrides)) {\n    const parts = path.split(/[\\[\\]\\.]+/).filter(Boolean);\n    let current = result;\n    \n    for (let i = 0; i < parts.length - 1; i++) {\n      const part = parts[i];\n      const nextPart = parts[i + 1];\n      \n      if (!current[part]) {\n        current[part] = isNaN(Number(nextPart)) ? {} : [];\n      }\n      current = current[part];\n    }\n    \n    current[parts[parts.length - 1]] = value;\n  }\n  \n  return result;\n}\n\n// Helper to parse JSON that might be wrapped in markdown code fences\nfunction parseMarkdownJSON(data: any): any {\n  if (!data) return data;\n  \n  // If it's already a proper object (not a string), return as-is\n  if (typeof data === 'object' && !Array.isArray(data) && data !== null) {\n    // Check if it has expected properties or if it's already parsed\n    if (data.drafts || data.recommended_channel_sequence || data.status || data.strategy_status) {\n      return data;\n    }\n  }\n  \n  // If it's a string, try to clean and parse it\n  if (typeof data === 'string') {\n    try {\n      // Strip markdown code fences\n      let cleaned = data.trim();\n      cleaned = cleaned.replace(/^```(?:json)?\\s*\\n?/i, \"\");\n      cleaned = cleaned.replace(/\\n?```\\s*$/i, \"\");\n      cleaned = cleaned.trim();\n      \n      // Only parse if it looks like JSON\n      if (cleaned.startsWith('{') || cleaned.startsWith('[')) {\n        return JSON.parse(cleaned);\n      }\n    } catch (e) {\n      console.warn(\"Could not parse markdown JSON:\", e);\n      return data;\n    }\n  }\n  \n  return data;\n}\n\nexport async function GET(request: NextRequest, { params }: RouteParams) {\n  try {\n    await connectDB();\n    const { id } = await params;\n    console.log(`‚úÖ Database connected for GET /api/leads/${id}/outreach`);\n\n    const leadId = id;\n\n    // Fetch lead with company and ICP score\n    const lead = await Lead.findById(leadId)\n      .populate(\"company_id\")\n      .populate(\"persona_id\");\n\n    if (!lead) {\n      return NextResponse.json(\n        {\n          success: false,\n          error: \"Lead not found\",\n        },\n        { status: 404 }\n      );\n    }\n\n    const company = lead.company_id as any;\n    const icpScore = await ICPScore.findOne({ lead_id: leadId });\n\n    // Fetch or create campaign\n    let campaign = await OutreachCampaign.findOne({ lead_id: leadId });\n    if (!campaign) {\n      campaign = await OutreachCampaign.create({ lead_id: leadId });\n    }\n\n    // Fetch latest strategy run\n    const strategyRun = await OutreachStrategyRun.findOne({ lead_id: leadId })\n      .sort({ createdAt: -1 })\n      .limit(1);\n\n    // Fetch latest copy run\n    const copyRun = await OutreachCopyRun.findOne({ lead_id: leadId })\n      .sort({ createdAt: -1 })\n      .limit(1);\n\n    // Fetch all events\n    const events = await OutreachEvent.find({ lead_id: leadId }).sort({\n      sort_order: 1,\n    });\n\n    // Fetch guardrails (lead-specific or global)\n    const guardrails = await (OutreachGuardrails as any).getForLead(leadId);\n\n    // Fetch overrides for strategy, copy, campaign, and guardrails\n    const campaignOverrides = await (FieldOverride as any).getOverridesForEntity(\n      \"outreach_campaign\",\n      campaign._id\n    );\n    const strategyOverrides = strategyRun\n      ? await (FieldOverride as any).getOverridesForEntity(\n          \"outreach_strategy\",\n          strategyRun._id\n        )\n      : {};\n    const copyOverrides = copyRun\n      ? await (FieldOverride as any).getOverridesForEntity(\n          \"outreach_copy\",\n          copyRun._id\n        )\n      : {};\n    const guardrailsOverrides = await (\n      FieldOverride as any\n    ).getOverridesForEntity(\"outreach_guardrails\", guardrails._id);\n\n    // Apply overrides (manual always wins)\n    const effectiveCampaign = applyOverrides(campaign.toObject(), campaignOverrides);\n    \n    // Parse strategy and copy outputs (in case they contain markdown-wrapped JSON from old data)\n    console.log(\"üîç Raw strategy_output type:\", typeof strategyRun?.strategy_output);\n    console.log(\"üîç Raw strategy_output preview:\", JSON.stringify(strategyRun?.strategy_output).substring(0, 100));\n    console.log(\"üîç Raw copy_output type:\", typeof copyRun?.copy_output);\n    console.log(\"üîç Raw copy_output preview:\", JSON.stringify(copyRun?.copy_output).substring(0, 100));\n    \n    const parsedStrategyOutput = strategyRun \n      ? parseMarkdownJSON(strategyRun.strategy_output)\n      : null;\n    const parsedCopyOutput = copyRun\n      ? parseMarkdownJSON(copyRun.copy_output)\n      : null;\n    \n    console.log(\"‚úÖ Parsed strategy has drafts?\", !!parsedStrategyOutput?.recommended_channel_sequence);\n    console.log(\"‚úÖ Parsed copy has drafts?\", !!parsedCopyOutput?.drafts, \"Count:\", parsedCopyOutput?.drafts?.length);\n    \n    const effectiveStrategy = parsedStrategyOutput\n      ? { ...applyOverrides(parsedStrategyOutput, strategyOverrides), _id: strategyRun._id }\n      : null;\n    const effectiveCopy = parsedCopyOutput\n      ? { ...applyOverrides(parsedCopyOutput, copyOverrides), _id: copyRun._id }\n      : null;\n    const effectiveGuardrails = applyOverrides(\n      guardrails.toObject(),\n      guardrailsOverrides\n    );\n\n    // Build response\n    const response = {\n      success: true,\n      data: {\n        lead: {\n          _id: lead._id,\n          name: lead.name,\n          title: lead.title,\n          email: lead.email,\n          company: {\n            name: company?.name || \"Unknown\",\n          },\n          icp_score: icpScore\n            ? {\n                icp_score: icpScore.icp_score,\n                fit_tier: icpScore.fit_tier,\n              }\n            : null,\n        },\n        campaign: effectiveCampaign,\n        strategy: effectiveStrategy,\n        copy: effectiveCopy,\n        events: events.map((e) => ({\n          id: e._id,\n          eventType: e.event_type,\n          timestamp: e.timestamp,\n          actor: e.actor,\n          title: e.title,\n          description: e.summary,\n          badge: e.badge,\n          channel: e.channel,\n          direction: e.direction,\n          content: e.content,\n          metadata: e.metadata,\n        })),\n        guardrails: effectiveGuardrails,\n      },\n    };\n\n    console.log(\n      `‚úÖ Retrieved outreach data for lead ${leadId} with ${events.length} events`\n    );\n\n    return NextResponse.json(response, { status: 200 });\n  } catch (error: any) {\n    console.error(\"‚ùå API Error:\", error);\n    return NextResponse.json(\n      {\n        success: false,\n        error: \"Internal server error\",\n        message: error.message || \"An unexpected error occurred\",\n      },\n      { status: 500 }\n    );\n  }\n}\n\n"],"names":[],"mappings":"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","debugId":null}}]
}