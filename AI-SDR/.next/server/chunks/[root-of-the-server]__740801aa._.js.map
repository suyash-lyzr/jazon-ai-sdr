{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 61, "column": 0}, "map": {"version":3,"sources":["file:///Users/suyashmankar/Desktop/LYZR/Jazon%20-%20AI%20SDR/AI-SDR-APP/AI-SDR/src/lib/mongodb.ts"],"sourcesContent":["import mongoose from 'mongoose';\n\n/**\n * Global is used here to maintain a cached connection across hot reloads\n * in development. This prevents connections growing exponentially\n * during API Route usage.\n */\ndeclare global {\n  var mongoose: {\n    conn: typeof mongoose | null;\n    promise: Promise<typeof mongoose> | null;\n  };\n}\n\nlet cached = global.mongoose;\n\nif (!cached) {\n  cached = global.mongoose = { conn: null, promise: null };\n}\n\nasync function connectDB() {\n  let MONGODB_URI = process.env.MONGODB_URI;\n\n  if (!MONGODB_URI) {\n    throw new Error(\n      'Please define the MONGODB_URI environment variable inside .env.local'\n    );\n  }\n\n  // Remove quotes if present\n  MONGODB_URI = MONGODB_URI.replace(/^[\"']|[\"']$/g, '');\n\n  // If we have a cached connection, return it\n  if (cached.conn) {\n    return cached.conn;\n  }\n\n  // If we don't have a cached promise, create one\n  if (!cached.promise) {\n    const opts = {\n      bufferCommands: false,\n    };\n\n    cached.promise = mongoose.connect(MONGODB_URI, opts).then(async (mongoose) => {\n      console.log('‚úÖ MongoDB connected successfully');\n      \n      // Ensure models are registered (Next.js hot reload fix)\n      // Dynamically import models to ensure they're registered after connection\n      if (!mongoose.models.Company) {\n        await import('@/models/Company');\n      }\n      if (!mongoose.models.Persona) {\n        await import('@/models/Persona');\n      }\n      if (!mongoose.models.Lead) {\n        await import('@/models/Lead');\n      }\n      \n      return mongoose;\n    });\n  }\n\n  try {\n    cached.conn = await cached.promise;\n  } catch (e) {\n    cached.promise = null;\n    throw e;\n  }\n\n  return cached.conn;\n}\n\nexport default connectDB;\n\n"],"names":[],"mappings":";;;;AAAA;;AAcA,IAAI,SAAS,OAAO,QAAQ;AAE5B,IAAI,CAAC,QAAQ;IACX,SAAS,OAAO,QAAQ,GAAG;QAAE,MAAM;QAAM,SAAS;IAAK;AACzD;AAEA,eAAe;IACb,IAAI,cAAc,QAAQ,GAAG,CAAC,WAAW;IAEzC,IAAI,CAAC,aAAa;QAChB,MAAM,IAAI,MACR;IAEJ;IAEA,2BAA2B;IAC3B,cAAc,YAAY,OAAO,CAAC,gBAAgB;IAElD,4CAA4C;IAC5C,IAAI,OAAO,IAAI,EAAE;QACf,OAAO,OAAO,IAAI;IACpB;IAEA,gDAAgD;IAChD,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,MAAM,OAAO;YACX,gBAAgB;QAClB;QAEA,OAAO,OAAO,GAAG,oHAAQ,CAAC,OAAO,CAAC,aAAa,MAAM,IAAI,CAAC,OAAO;YAC/D,QAAQ,GAAG,CAAC;YAEZ,wDAAwD;YACxD,0EAA0E;YAC1E,IAAI,CAAC,SAAS,MAAM,CAAC,OAAO,EAAE;gBAC5B;YACF;YACA,IAAI,CAAC,SAAS,MAAM,CAAC,OAAO,EAAE;gBAC5B;YACF;YACA,IAAI,CAAC,SAAS,MAAM,CAAC,IAAI,EAAE;gBACzB;YACF;YAEA,OAAO;QACT;IACF;IAEA,IAAI;QACF,OAAO,IAAI,GAAG,MAAM,OAAO,OAAO;IACpC,EAAE,OAAO,GAAG;QACV,OAAO,OAAO,GAAG;QACjB,MAAM;IACR;IAEA,OAAO,OAAO,IAAI;AACpB;uCAEe","debugId":null}},
    {"offset": {"line": 119, "column": 0}, "map": {"version":3,"sources":["file:///Users/suyashmankar/Desktop/LYZR/Jazon%20-%20AI%20SDR/AI-SDR-APP/AI-SDR/src/models/Lead.ts"],"sourcesContent":["import mongoose, { Document, Model, Schema } from \"mongoose\";\n\nexport interface ISourceMetadata {\n  apollo_list_name?: string;\n  apollo_person_id?: string;\n  hubspot_contact_id?: string;\n  salesforce_lead_id?: string;\n}\n\nexport type LeadStatus = \"uploaded\" | \"researched\" | \"icp_scored\";\n\nexport interface ILead extends Document {\n  name: string;\n  title: string;\n  email?: string;\n  company_id: mongoose.Types.ObjectId;\n  persona_id: mongoose.Types.ObjectId;\n  status: LeadStatus;\n  source: string;\n  source_metadata?: ISourceMetadata;\n  createdAt: Date;\n  updatedAt: Date;\n}\n\nconst SourceMetadataSchema = new Schema<ISourceMetadata>(\n  {\n    apollo_list_name: { type: String },\n    apollo_person_id: { type: String },\n    hubspot_contact_id: { type: String },\n    salesforce_lead_id: { type: String },\n  },\n  { _id: false }\n);\n\nconst LeadSchema = new Schema<ILead>(\n  {\n    name: {\n      type: String,\n      required: true,\n    },\n    title: {\n      type: String,\n      required: true,\n    },\n    email: {\n      type: String,\n      required: false,\n    },\n    company_id: {\n      type: Schema.Types.ObjectId,\n      ref: \"Company\",\n      required: true,\n      index: true,\n    },\n    persona_id: {\n      type: Schema.Types.ObjectId,\n      ref: \"Persona\",\n      required: true,\n      index: true,\n    },\n    status: {\n      type: String,\n      enum: [\"uploaded\", \"researched\", \"icp_scored\"],\n      required: true,\n      default: \"uploaded\",\n      index: true,\n    },\n    source: {\n      type: String,\n      default: \"CSV\",\n    },\n    source_metadata: {\n      type: SourceMetadataSchema,\n      required: false,\n    },\n  },\n  {\n    timestamps: true,\n    collection: \"leads\",\n  }\n);\n\n// Indexes for common queries\nLeadSchema.index({ company_id: 1, persona_id: 1 });\nLeadSchema.index({ status: 1, createdAt: -1 });\n\nconst Lead: Model<ILead> =\n  mongoose.models.Lead || mongoose.model<ILead>(\"Lead\", LeadSchema);\n\nexport default Lead;\n"],"names":[],"mappings":";;;;AAAA;;AAwBA,MAAM,uBAAuB,IAAI,mHAAM,CACrC;IACE,kBAAkB;QAAE,MAAM;IAAO;IACjC,kBAAkB;QAAE,MAAM;IAAO;IACjC,oBAAoB;QAAE,MAAM;IAAO;IACnC,oBAAoB;QAAE,MAAM;IAAO;AACrC,GACA;IAAE,KAAK;AAAM;AAGf,MAAM,aAAa,IAAI,mHAAM,CAC3B;IACE,MAAM;QACJ,MAAM;QACN,UAAU;IACZ;IACA,OAAO;QACL,MAAM;QACN,UAAU;IACZ;IACA,OAAO;QACL,MAAM;QACN,UAAU;IACZ;IACA,YAAY;QACV,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;QACV,OAAO;IACT;IACA,YAAY;QACV,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;QACV,OAAO;IACT;IACA,QAAQ;QACN,MAAM;QACN,MAAM;YAAC;YAAY;YAAc;SAAa;QAC9C,UAAU;QACV,SAAS;QACT,OAAO;IACT;IACA,QAAQ;QACN,MAAM;QACN,SAAS;IACX;IACA,iBAAiB;QACf,MAAM;QACN,UAAU;IACZ;AACF,GACA;IACE,YAAY;IACZ,YAAY;AACd;AAGF,6BAA6B;AAC7B,WAAW,KAAK,CAAC;IAAE,YAAY;IAAG,YAAY;AAAE;AAChD,WAAW,KAAK,CAAC;IAAE,QAAQ;IAAG,WAAW,CAAC;AAAE;AAE5C,MAAM,OACJ,oHAAQ,CAAC,MAAM,CAAC,IAAI,IAAI,oHAAQ,CAAC,KAAK,CAAQ,QAAQ;uCAEzC","debugId":null}},
    {"offset": {"line": 204, "column": 0}, "map": {"version":3,"sources":["file:///Users/suyashmankar/Desktop/LYZR/Jazon%20-%20AI%20SDR/AI-SDR-APP/AI-SDR/src/models/ResearchRun.ts"],"sourcesContent":["import mongoose, { Document, Model, Schema } from \"mongoose\";\n\nexport interface IRequestedLead {\n  name: string;\n  title: string;\n  company: string;\n  email: string;\n}\n\nexport interface IResearchMeta {\n  requested_lead: IRequestedLead;\n  research_timestamp_utc: string;\n  tools_used: string[];\n  data_quality_warnings: string[];\n}\n\nexport interface IResearchRun extends Document {\n  lead_id: mongoose.Types.ObjectId;\n  company_id: mongoose.Types.ObjectId;\n  persona_id: mongoose.Types.ObjectId;\n  research_meta: IResearchMeta;\n  createdAt: Date;\n  updatedAt: Date;\n}\n\nconst RequestedLeadSchema = new Schema<IRequestedLead>(\n  {\n    name: { type: String, default: \"\" },\n    title: { type: String, default: \"\" },\n    company: { type: String, default: \"\" },\n    email: { type: String, default: \"\" },\n  },\n  { _id: false }\n);\n\nconst ResearchMetaSchema = new Schema<IResearchMeta>(\n  {\n    requested_lead: {\n      type: RequestedLeadSchema,\n      default: () => ({}),\n    },\n    research_timestamp_utc: { type: String, default: \"\" },\n    tools_used: { type: [String], default: [] },\n    data_quality_warnings: { type: [String], default: [] },\n  },\n  { _id: false }\n);\n\nconst ResearchRunSchema = new Schema<IResearchRun>(\n  {\n    lead_id: {\n      type: Schema.Types.ObjectId,\n      ref: \"Lead\",\n      required: true,\n      unique: true,\n      index: true,\n    },\n    company_id: {\n      type: Schema.Types.ObjectId,\n      ref: \"Company\",\n      required: true,\n    },\n    persona_id: {\n      type: Schema.Types.ObjectId,\n      ref: \"Persona\",\n      required: true,\n    },\n    research_meta: {\n      type: ResearchMetaSchema,\n      default: () => ({}),\n    },\n  },\n  {\n    timestamps: true,\n    collection: \"research_runs\",\n  }\n);\n\nconst ResearchRun: Model<IResearchRun> =\n  mongoose.models.ResearchRun ||\n  mongoose.model<IResearchRun>(\"ResearchRun\", ResearchRunSchema);\n\nexport default ResearchRun;\n\n"],"names":[],"mappings":";;;;AAAA;;AAyBA,MAAM,sBAAsB,IAAI,mHAAM,CACpC;IACE,MAAM;QAAE,MAAM;QAAQ,SAAS;IAAG;IAClC,OAAO;QAAE,MAAM;QAAQ,SAAS;IAAG;IACnC,SAAS;QAAE,MAAM;QAAQ,SAAS;IAAG;IACrC,OAAO;QAAE,MAAM;QAAQ,SAAS;IAAG;AACrC,GACA;IAAE,KAAK;AAAM;AAGf,MAAM,qBAAqB,IAAI,mHAAM,CACnC;IACE,gBAAgB;QACd,MAAM;QACN,SAAS,IAAM,CAAC,CAAC,CAAC;IACpB;IACA,wBAAwB;QAAE,MAAM;QAAQ,SAAS;IAAG;IACpD,YAAY;QAAE,MAAM;YAAC;SAAO;QAAE,SAAS,EAAE;IAAC;IAC1C,uBAAuB;QAAE,MAAM;YAAC;SAAO;QAAE,SAAS,EAAE;IAAC;AACvD,GACA;IAAE,KAAK;AAAM;AAGf,MAAM,oBAAoB,IAAI,mHAAM,CAClC;IACE,SAAS;QACP,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;QACV,QAAQ;QACR,OAAO;IACT;IACA,YAAY;QACV,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;IACZ;IACA,YAAY;QACV,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;IACZ;IACA,eAAe;QACb,MAAM;QACN,SAAS,IAAM,CAAC,CAAC,CAAC;IACpB;AACF,GACA;IACE,YAAY;IACZ,YAAY;AACd;AAGF,MAAM,cACJ,oHAAQ,CAAC,MAAM,CAAC,WAAW,IAC3B,oHAAQ,CAAC,KAAK,CAAe,eAAe;uCAE/B","debugId":null}},
    {"offset": {"line": 286, "column": 0}, "map": {"version":3,"sources":["file:///Users/suyashmankar/Desktop/LYZR/Jazon%20-%20AI%20SDR/AI-SDR-APP/AI-SDR/src/models/ICPScore.ts"],"sourcesContent":["import mongoose, { Document, Model, Schema } from \"mongoose\";\n\nexport interface IScoreBreakdown {\n  company_fit: number;\n  persona_fit: number;\n  timing_fit: number;\n}\n\nexport interface IScoringMeta {\n  inputs_used: string[];\n  scored_at: string;\n}\n\nexport interface IICPScore extends Document {\n  lead_id: mongoose.Types.ObjectId;\n  icp_score: number;\n  fit_tier: \"Tier 1\" | \"Tier 2\" | \"Tier 3\" | \"Disqualified\";\n  score_breakdown: IScoreBreakdown;\n  strengths: string[];\n  risks: string[];\n  gaps: string[];\n  confidence_level: \"High\" | \"Medium\" | \"Low\";\n  scoring_meta: IScoringMeta;\n  createdAt: Date;\n  updatedAt: Date;\n}\n\nconst ScoreBreakdownSchema = new Schema<IScoreBreakdown>(\n  {\n    company_fit: { type: Number, default: 0 },\n    persona_fit: { type: Number, default: 0 },\n    timing_fit: { type: Number, default: 0 },\n  },\n  { _id: false }\n);\n\nconst ScoringMetaSchema = new Schema<IScoringMeta>(\n  {\n    inputs_used: { type: [String], default: [] },\n    scored_at: { type: String, default: \"\" },\n  },\n  { _id: false }\n);\n\nconst ICPScoreSchema = new Schema<IICPScore>(\n  {\n    lead_id: {\n      type: Schema.Types.ObjectId,\n      ref: \"Lead\",\n      required: true,\n      unique: true,\n      index: true,\n    },\n    icp_score: {\n      type: Number,\n      required: true,\n      min: 0,\n      max: 100,\n      index: true,\n    },\n    fit_tier: {\n      type: String,\n      enum: [\"Tier 1\", \"Tier 2\", \"Tier 3\", \"Disqualified\"],\n      required: true,\n      index: true,\n    },\n    score_breakdown: {\n      type: ScoreBreakdownSchema,\n      default: () => ({}),\n    },\n    strengths: {\n      type: [String],\n      default: [],\n    },\n    risks: {\n      type: [String],\n      default: [],\n    },\n    gaps: {\n      type: [String],\n      default: [],\n    },\n    confidence_level: {\n      type: String,\n      enum: [\"High\", \"Medium\", \"Low\"],\n      default: \"Low\",\n    },\n    scoring_meta: {\n      type: ScoringMetaSchema,\n      default: () => ({}),\n    },\n  },\n  {\n    timestamps: true,\n    collection: \"icp_scores\",\n  }\n);\n\nconst ICPScore: Model<IICPScore> =\n  mongoose.models.ICPScore ||\n  mongoose.model<IICPScore>(\"ICPScore\", ICPScoreSchema);\n\nexport default ICPScore;\n\n"],"names":[],"mappings":";;;;AAAA;;AA2BA,MAAM,uBAAuB,IAAI,mHAAM,CACrC;IACE,aAAa;QAAE,MAAM;QAAQ,SAAS;IAAE;IACxC,aAAa;QAAE,MAAM;QAAQ,SAAS;IAAE;IACxC,YAAY;QAAE,MAAM;QAAQ,SAAS;IAAE;AACzC,GACA;IAAE,KAAK;AAAM;AAGf,MAAM,oBAAoB,IAAI,mHAAM,CAClC;IACE,aAAa;QAAE,MAAM;YAAC;SAAO;QAAE,SAAS,EAAE;IAAC;IAC3C,WAAW;QAAE,MAAM;QAAQ,SAAS;IAAG;AACzC,GACA;IAAE,KAAK;AAAM;AAGf,MAAM,iBAAiB,IAAI,mHAAM,CAC/B;IACE,SAAS;QACP,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;QACV,QAAQ;QACR,OAAO;IACT;IACA,WAAW;QACT,MAAM;QACN,UAAU;QACV,KAAK;QACL,KAAK;QACL,OAAO;IACT;IACA,UAAU;QACR,MAAM;QACN,MAAM;YAAC;YAAU;YAAU;YAAU;SAAe;QACpD,UAAU;QACV,OAAO;IACT;IACA,iBAAiB;QACf,MAAM;QACN,SAAS,IAAM,CAAC,CAAC,CAAC;IACpB;IACA,WAAW;QACT,MAAM;YAAC;SAAO;QACd,SAAS,EAAE;IACb;IACA,OAAO;QACL,MAAM;YAAC;SAAO;QACd,SAAS,EAAE;IACb;IACA,MAAM;QACJ,MAAM;YAAC;SAAO;QACd,SAAS,EAAE;IACb;IACA,kBAAkB;QAChB,MAAM;QACN,MAAM;YAAC;YAAQ;YAAU;SAAM;QAC/B,SAAS;IACX;IACA,cAAc;QACZ,MAAM;QACN,SAAS,IAAM,CAAC,CAAC,CAAC;IACpB;AACF,GACA;IACE,YAAY;IACZ,YAAY;AACd;AAGF,MAAM,WACJ,oHAAQ,CAAC,MAAM,CAAC,QAAQ,IACxB,oHAAQ,CAAC,KAAK,CAAY,YAAY;uCAEzB","debugId":null}},
    {"offset": {"line": 393, "column": 0}, "map": {"version":3,"sources":["file:///Users/suyashmankar/Desktop/LYZR/Jazon%20-%20AI%20SDR/AI-SDR-APP/AI-SDR/src/models/OutreachCampaign.ts"],"sourcesContent":["import mongoose, { Document, Model, Schema } from \"mongoose\";\n\nexport interface IOutreachCampaign extends Document {\n  lead_id: mongoose.Types.ObjectId;\n  status:\n    | \"not_started\"\n    | \"active\"\n    | \"paused\"\n    | \"stopped\"\n    | \"completed\"\n    | \"disqualified\";\n  current_phase: \"Research\" | \"Engagement\" | \"Qualification\" | \"Handoff\";\n  current_step_number: number;\n  next_planned_action: {\n    label: string;\n    scheduled_at: Date | null;\n  };\n  final_decision: {\n    status: string;\n    reason: string;\n  };\n  channel_mix: {\n    email: number;\n    linkedin: number;\n    voice: number;\n  };\n  response_rate: number;\n  avg_response_time: number;\n  createdAt: Date;\n  updatedAt: Date;\n}\n\nconst OutreachCampaignSchema = new Schema<IOutreachCampaign>(\n  {\n    lead_id: {\n      type: Schema.Types.ObjectId,\n      ref: \"Lead\",\n      required: true,\n      unique: true,\n      index: true,\n    },\n    status: {\n      type: String,\n      enum: [\n        \"not_started\",\n        \"active\",\n        \"paused\",\n        \"stopped\",\n        \"completed\",\n        \"disqualified\",\n      ],\n      default: \"not_started\",\n    },\n    current_phase: {\n      type: String,\n      enum: [\"Research\", \"Engagement\", \"Qualification\", \"Handoff\"],\n      default: \"Research\",\n    },\n    current_step_number: {\n      type: Number,\n      default: 0,\n    },\n    next_planned_action: {\n      label: {\n        type: String,\n        default: \"Generate outreach strategy\",\n      },\n      scheduled_at: {\n        type: Date,\n        default: null,\n      },\n    },\n    final_decision: {\n      status: {\n        type: String,\n        default: \"Pending\",\n      },\n      reason: {\n        type: String,\n        default: \"Outreach not yet generated\",\n      },\n    },\n    channel_mix: {\n      email: {\n        type: Number,\n        default: 0,\n      },\n      linkedin: {\n        type: Number,\n        default: 0,\n      },\n      voice: {\n        type: Number,\n        default: 0,\n      },\n    },\n    response_rate: {\n      type: Number,\n      default: 0,\n    },\n    avg_response_time: {\n      type: Number,\n      default: 0,\n    },\n  },\n  {\n    timestamps: true,\n    collection: \"outreach_campaigns\",\n  }\n);\n\nconst OutreachCampaign: Model<IOutreachCampaign> =\n  mongoose.models.OutreachCampaign ||\n  mongoose.model<IOutreachCampaign>(\"OutreachCampaign\", OutreachCampaignSchema);\n\nexport default OutreachCampaign;\n\n"],"names":[],"mappings":";;;;AAAA;;AAgCA,MAAM,yBAAyB,IAAI,mHAAM,CACvC;IACE,SAAS;QACP,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;QACV,QAAQ;QACR,OAAO;IACT;IACA,QAAQ;QACN,MAAM;QACN,MAAM;YACJ;YACA;YACA;YACA;YACA;YACA;SACD;QACD,SAAS;IACX;IACA,eAAe;QACb,MAAM;QACN,MAAM;YAAC;YAAY;YAAc;YAAiB;SAAU;QAC5D,SAAS;IACX;IACA,qBAAqB;QACnB,MAAM;QACN,SAAS;IACX;IACA,qBAAqB;QACnB,OAAO;YACL,MAAM;YACN,SAAS;QACX;QACA,cAAc;YACZ,MAAM;YACN,SAAS;QACX;IACF;IACA,gBAAgB;QACd,QAAQ;YACN,MAAM;YACN,SAAS;QACX;QACA,QAAQ;YACN,MAAM;YACN,SAAS;QACX;IACF;IACA,aAAa;QACX,OAAO;YACL,MAAM;YACN,SAAS;QACX;QACA,UAAU;YACR,MAAM;YACN,SAAS;QACX;QACA,OAAO;YACL,MAAM;YACN,SAAS;QACX;IACF;IACA,eAAe;QACb,MAAM;QACN,SAAS;IACX;IACA,mBAAmB;QACjB,MAAM;QACN,SAAS;IACX;AACF,GACA;IACE,YAAY;IACZ,YAAY;AACd;AAGF,MAAM,mBACJ,oHAAQ,CAAC,MAAM,CAAC,gBAAgB,IAChC,oHAAQ,CAAC,KAAK,CAAoB,oBAAoB;uCAEzC","debugId":null}},
    {"offset": {"line": 485, "column": 0}, "map": {"version":3,"sources":["file:///Users/suyashmankar/Desktop/LYZR/Jazon%20-%20AI%20SDR/AI-SDR-APP/AI-SDR/src/models/OutreachStrategyRun.ts"],"sourcesContent":["import mongoose, { Document, Model, Schema } from \"mongoose\";\n\nexport interface IOutreachStrategyRun extends Document {\n  lead_id: mongoose.Types.ObjectId;\n  research_run_id: mongoose.Types.ObjectId;\n  icp_score_id: mongoose.Types.ObjectId;\n  strategy_output: {\n    strategy_status: string;\n    strategy_meta: {\n      generated_at: Date;\n      model: string;\n      inputs_used: {\n        research_run_id: string;\n        icp_score_id: string;\n      };\n    };\n    plan_summary: string;\n    target_persona: {\n      title: string;\n      seniority: string;\n      department: string;\n    };\n    recommended_channel_sequence: Array<{\n      step: number;\n      channel: string;\n      intent: string;\n      goal: string;\n      reasoning: string;\n      recommended_delay_hours: number;\n      send_window: string;\n      personalization_signals: string[];\n      content_request: string;\n      gating_conditions: string[];\n    }>;\n    voice_readiness: {\n      thresholds: {\n        icp_min: number;\n        engagement_channels_min: number;\n      };\n      human_approval_required: boolean;\n      rationale: string;\n    };\n    sequencing_logic: {\n      rationale: string;\n      recommended_delays: string;\n    };\n    risk_flags: string[];\n    confidence_level: string;\n  };\n  createdAt: Date;\n  updatedAt: Date;\n}\n\nconst OutreachStrategyRunSchema = new Schema<IOutreachStrategyRun>(\n  {\n    lead_id: {\n      type: Schema.Types.ObjectId,\n      ref: \"Lead\",\n      required: true,\n      index: true,\n    },\n    research_run_id: {\n      type: Schema.Types.ObjectId,\n      ref: \"ResearchRun\",\n      required: true,\n    },\n    icp_score_id: {\n      type: Schema.Types.ObjectId,\n      ref: \"ICPScore\",\n      required: true,\n    },\n    strategy_output: {\n      type: Schema.Types.Mixed,\n      required: true,\n    },\n  },\n  {\n    timestamps: true,\n    collection: \"outreach_strategy_runs\",\n  }\n);\n\n// Index for finding latest strategy run per lead\nOutreachStrategyRunSchema.index({ lead_id: 1, createdAt: -1 });\n\nconst OutreachStrategyRun: Model<IOutreachStrategyRun> =\n  mongoose.models.OutreachStrategyRun ||\n  mongoose.model<IOutreachStrategyRun>(\n    \"OutreachStrategyRun\",\n    OutreachStrategyRunSchema\n  );\n\nexport default OutreachStrategyRun;\n\n"],"names":[],"mappings":";;;;AAAA;;AAqDA,MAAM,4BAA4B,IAAI,mHAAM,CAC1C;IACE,SAAS;QACP,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;QACV,OAAO;IACT;IACA,iBAAiB;QACf,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;IACZ;IACA,cAAc;QACZ,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;IACZ;IACA,iBAAiB;QACf,MAAM,mHAAM,CAAC,KAAK,CAAC,KAAK;QACxB,UAAU;IACZ;AACF,GACA;IACE,YAAY;IACZ,YAAY;AACd;AAGF,iDAAiD;AACjD,0BAA0B,KAAK,CAAC;IAAE,SAAS;IAAG,WAAW,CAAC;AAAE;AAE5D,MAAM,sBACJ,oHAAQ,CAAC,MAAM,CAAC,mBAAmB,IACnC,oHAAQ,CAAC,KAAK,CACZ,uBACA;uCAGW","debugId":null}},
    {"offset": {"line": 527, "column": 0}, "map": {"version":3,"sources":["file:///Users/suyashmankar/Desktop/LYZR/Jazon%20-%20AI%20SDR/AI-SDR-APP/AI-SDR/src/models/OutreachCopyRun.ts"],"sourcesContent":["import mongoose, { Document, Model, Schema } from \"mongoose\";\n\nexport interface IOutreachCopyRun extends Document {\n  lead_id: mongoose.Types.ObjectId;\n  strategy_run_id: mongoose.Types.ObjectId;\n  copy_output: {\n    status: string;\n    channel: string;\n    copy_meta: {\n      generated_at: Date;\n      model: string;\n      strategy_run_id: string;\n    };\n    drafts: Array<{\n      step: number;\n      channel: string;\n      subject_options: string[];\n      body: string;\n      talking_points: string[];\n      personalization_used: string[];\n      strategy_alignment: string;\n    }>;\n    confidence_level: string;\n    review_notes: string[];\n  };\n  createdAt: Date;\n  updatedAt: Date;\n}\n\nconst OutreachCopyRunSchema = new Schema<IOutreachCopyRun>(\n  {\n    lead_id: {\n      type: Schema.Types.ObjectId,\n      ref: \"Lead\",\n      required: true,\n      index: true,\n    },\n    strategy_run_id: {\n      type: Schema.Types.ObjectId,\n      ref: \"OutreachStrategyRun\",\n      required: true,\n    },\n    copy_output: {\n      type: Schema.Types.Mixed,\n      required: true,\n    },\n  },\n  {\n    timestamps: true,\n    collection: \"outreach_copy_runs\",\n  }\n);\n\n// Index for finding latest copy run per lead\nOutreachCopyRunSchema.index({ lead_id: 1, createdAt: -1 });\n\nconst OutreachCopyRun: Model<IOutreachCopyRun> =\n  mongoose.models.OutreachCopyRun ||\n  mongoose.model<IOutreachCopyRun>(\"OutreachCopyRun\", OutreachCopyRunSchema);\n\nexport default OutreachCopyRun;\n\n"],"names":[],"mappings":";;;;AAAA;;AA6BA,MAAM,wBAAwB,IAAI,mHAAM,CACtC;IACE,SAAS;QACP,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;QACV,OAAO;IACT;IACA,iBAAiB;QACf,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;IACZ;IACA,aAAa;QACX,MAAM,mHAAM,CAAC,KAAK,CAAC,KAAK;QACxB,UAAU;IACZ;AACF,GACA;IACE,YAAY;IACZ,YAAY;AACd;AAGF,6CAA6C;AAC7C,sBAAsB,KAAK,CAAC;IAAE,SAAS;IAAG,WAAW,CAAC;AAAE;AAExD,MAAM,kBACJ,oHAAQ,CAAC,MAAM,CAAC,eAAe,IAC/B,oHAAQ,CAAC,KAAK,CAAmB,mBAAmB;uCAEvC","debugId":null}},
    {"offset": {"line": 564, "column": 0}, "map": {"version":3,"sources":["file:///Users/suyashmankar/Desktop/LYZR/Jazon%20-%20AI%20SDR/AI-SDR-APP/AI-SDR/src/models/OutreachEvent.ts"],"sourcesContent":["import mongoose, { Document, Model, Schema } from \"mongoose\";\n\nexport type OutreachEventType =\n  | \"lifecycle\"\n  | \"research\"\n  | \"outreach\"\n  | \"engagement\"\n  | \"decision\"\n  | \"guardrail\"\n  | \"outcome\";\n\nexport type OutreachEventActor = \"AI\" | \"System\" | \"Human\";\n\nexport interface IOutreachEvent extends Document {\n  lead_id: mongoose.Types.ObjectId;\n  campaign_id: mongoose.Types.ObjectId;\n  event_type: OutreachEventType;\n  actor: OutreachEventActor;\n  timestamp: Date;\n  sort_order: number;\n  title: string;\n  summary: string;\n  badge: string;\n  channel?: string;\n  direction?: \"inbound\" | \"outbound\";\n  content?: {\n    subject?: string;\n    body?: string;\n    talking_points?: string[];\n  };\n  metadata: Record<string, any>;\n  createdAt: Date;\n}\n\nconst OutreachEventSchema = new Schema<IOutreachEvent>(\n  {\n    lead_id: {\n      type: Schema.Types.ObjectId,\n      ref: \"Lead\",\n      required: true,\n      index: true,\n    },\n    campaign_id: {\n      type: Schema.Types.ObjectId,\n      ref: \"OutreachCampaign\",\n      required: true,\n      index: true,\n    },\n    event_type: {\n      type: String,\n      enum: [\n        \"lifecycle\",\n        \"research\",\n        \"outreach\",\n        \"engagement\",\n        \"decision\",\n        \"guardrail\",\n        \"outcome\",\n      ],\n      required: true,\n    },\n    actor: {\n      type: String,\n      enum: [\"AI\", \"System\", \"Human\"],\n      required: true,\n    },\n    timestamp: {\n      type: Date,\n      required: true,\n      index: true,\n    },\n    sort_order: {\n      type: Number,\n      required: true,\n    },\n    title: {\n      type: String,\n      required: true,\n    },\n    summary: {\n      type: String,\n      required: true,\n    },\n    badge: {\n      type: String,\n      default: \"\",\n    },\n    channel: {\n      type: String,\n      default: \"\",\n    },\n    direction: {\n      type: String,\n      enum: [\"inbound\", \"outbound\", \"\"],\n      default: \"\",\n    },\n    content: {\n      subject: String,\n      body: String,\n      talking_points: [String],\n    },\n    metadata: {\n      type: Schema.Types.Mixed,\n      default: {},\n    },\n  },\n  {\n    timestamps: true,\n    collection: \"outreach_events\",\n  }\n);\n\n// Compound index for chronological queries\nOutreachEventSchema.index({ lead_id: 1, sort_order: 1 });\nOutreachEventSchema.index({ campaign_id: 1, timestamp: 1 });\n\nconst OutreachEvent: Model<IOutreachEvent> =\n  mongoose.models.OutreachEvent ||\n  mongoose.model<IOutreachEvent>(\"OutreachEvent\", OutreachEventSchema);\n\nexport default OutreachEvent;\n\n"],"names":[],"mappings":";;;;AAAA;;AAkCA,MAAM,sBAAsB,IAAI,mHAAM,CACpC;IACE,SAAS;QACP,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;QACV,OAAO;IACT;IACA,aAAa;QACX,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;QACV,OAAO;IACT;IACA,YAAY;QACV,MAAM;QACN,MAAM;YACJ;YACA;YACA;YACA;YACA;YACA;YACA;SACD;QACD,UAAU;IACZ;IACA,OAAO;QACL,MAAM;QACN,MAAM;YAAC;YAAM;YAAU;SAAQ;QAC/B,UAAU;IACZ;IACA,WAAW;QACT,MAAM;QACN,UAAU;QACV,OAAO;IACT;IACA,YAAY;QACV,MAAM;QACN,UAAU;IACZ;IACA,OAAO;QACL,MAAM;QACN,UAAU;IACZ;IACA,SAAS;QACP,MAAM;QACN,UAAU;IACZ;IACA,OAAO;QACL,MAAM;QACN,SAAS;IACX;IACA,SAAS;QACP,MAAM;QACN,SAAS;IACX;IACA,WAAW;QACT,MAAM;QACN,MAAM;YAAC;YAAW;YAAY;SAAG;QACjC,SAAS;IACX;IACA,SAAS;QACP,SAAS;QACT,MAAM;QACN,gBAAgB;YAAC;SAAO;IAC1B;IACA,UAAU;QACR,MAAM,mHAAM,CAAC,KAAK,CAAC,KAAK;QACxB,SAAS,CAAC;IACZ;AACF,GACA;IACE,YAAY;IACZ,YAAY;AACd;AAGF,2CAA2C;AAC3C,oBAAoB,KAAK,CAAC;IAAE,SAAS;IAAG,YAAY;AAAE;AACtD,oBAAoB,KAAK,CAAC;IAAE,aAAa;IAAG,WAAW;AAAE;AAEzD,MAAM,gBACJ,oHAAQ,CAAC,MAAM,CAAC,aAAa,IAC7B,oHAAQ,CAAC,KAAK,CAAiB,iBAAiB;uCAEnC","debugId":null}},
    {"offset": {"line": 669, "column": 0}, "map": {"version":3,"sources":["file:///Users/suyashmankar/Desktop/LYZR/Jazon%20-%20AI%20SDR/AI-SDR-APP/AI-SDR/src/models/DetectedSignal.ts"],"sourcesContent":["import mongoose, { Document, Model, Schema } from \"mongoose\";\n\nexport type SignalType =\n  | \"organizational\"\n  | \"technical\"\n  | \"financial\"\n  | \"intent\"\n  | \"engagement\"\n  | \"persona_change\"\n  | \"other\";\n\nexport interface IDetectedSignal extends Document {\n  lead_id: mongoose.Types.ObjectId;\n  research_run_id: mongoose.Types.ObjectId;\n  type: SignalType;\n  signal: string;\n  source: string;\n  strength: \"high\" | \"medium\" | \"low\";\n  recency: string;\n  evidence: string[];\n  createdAt: Date;\n}\n\nconst DetectedSignalSchema = new Schema<IDetectedSignal>(\n  {\n    lead_id: {\n      type: Schema.Types.ObjectId,\n      ref: \"Lead\",\n      required: true,\n      index: true,\n    },\n    research_run_id: {\n      type: Schema.Types.ObjectId,\n      ref: \"ResearchRun\",\n      required: true,\n    },\n    type: {\n      type: String,\n      enum: [\n        \"organizational\",\n        \"technical\",\n        \"financial\",\n        \"intent\",\n        \"engagement\",\n        \"persona_change\",\n        \"other\",\n      ],\n      required: true,\n    },\n    signal: {\n      type: String,\n      required: true,\n    },\n    source: {\n      type: String,\n      default: \"\",\n    },\n    strength: {\n      type: String,\n      enum: [\"high\", \"medium\", \"low\"],\n      default: \"medium\",\n    },\n    recency: {\n      type: String,\n      default: \"\",\n    },\n    evidence: {\n      type: [String],\n      default: [],\n    },\n  },\n  {\n    timestamps: true,\n    collection: \"detected_signals\",\n  }\n);\n\n// Compound index for efficient queries\nDetectedSignalSchema.index({ lead_id: 1, type: 1 });\n\nconst DetectedSignal: Model<IDetectedSignal> =\n  mongoose.models.DetectedSignal ||\n  mongoose.model<IDetectedSignal>(\"DetectedSignal\", DetectedSignalSchema);\n\nexport default DetectedSignal;\n\n"],"names":[],"mappings":";;;;AAAA;;AAuBA,MAAM,uBAAuB,IAAI,mHAAM,CACrC;IACE,SAAS;QACP,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;QACV,OAAO;IACT;IACA,iBAAiB;QACf,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;IACZ;IACA,MAAM;QACJ,MAAM;QACN,MAAM;YACJ;YACA;YACA;YACA;YACA;YACA;YACA;SACD;QACD,UAAU;IACZ;IACA,QAAQ;QACN,MAAM;QACN,UAAU;IACZ;IACA,QAAQ;QACN,MAAM;QACN,SAAS;IACX;IACA,UAAU;QACR,MAAM;QACN,MAAM;YAAC;YAAQ;YAAU;SAAM;QAC/B,SAAS;IACX;IACA,SAAS;QACP,MAAM;QACN,SAAS;IACX;IACA,UAAU;QACR,MAAM;YAAC;SAAO;QACd,SAAS,EAAE;IACb;AACF,GACA;IACE,YAAY;IACZ,YAAY;AACd;AAGF,uCAAuC;AACvC,qBAAqB,KAAK,CAAC;IAAE,SAAS;IAAG,MAAM;AAAE;AAEjD,MAAM,iBACJ,oHAAQ,CAAC,MAAM,CAAC,cAAc,IAC9B,oHAAQ,CAAC,KAAK,CAAkB,kBAAkB;uCAErC","debugId":null}},
    {"offset": {"line": 742, "column": 0}, "map": {"version":3,"sources":["file:///Users/suyashmankar/Desktop/LYZR/Jazon%20-%20AI%20SDR/AI-SDR-APP/AI-SDR/src/app/api/leads/%5Bid%5D/outreach/generate/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport connectDB from \"@/lib/mongodb\";\nimport Lead from \"@/models/Lead\";\nimport ResearchRun from \"@/models/ResearchRun\";\nimport ICPScore from \"@/models/ICPScore\";\nimport OutreachCampaign from \"@/models/OutreachCampaign\";\nimport OutreachStrategyRun from \"@/models/OutreachStrategyRun\";\nimport OutreachCopyRun from \"@/models/OutreachCopyRun\";\nimport OutreachEvent from \"@/models/OutreachEvent\";\nimport DetectedSignal from \"@/models/DetectedSignal\";\n\nexport const runtime = \"nodejs\";\nexport const maxDuration = 300;\n\nconst LYXR_AGENT_API_URL =\n  \"https://agent-prod.studio.lyzr.ai/v3/inference/chat/\";\nconst LYXR_API_KEY = process.env.LYZR_API_KEY || \"sk-default-eE6EHcdIhXl61H4mK4YKZFqISTGrruf1\";\nconst OUTREACH_STRATEGY_AGENT_ID = process.env.OUTREACH_STRATEGY_AGENT_ID || \"69453743f6d93e181164e4d0\";\nconst OUTREACH_COPY_AGENT_ID = process.env.OUTREACH_COPY_AGENT_ID || \"6948162d2be72f04a7d64f65\";\nconst USER_ID = process.env.LYZR_USER_ID || \"suyash@lyzr.ai\";\n\ninterface RouteParams {\n  params: Promise<{ id: string }>;\n}\n\nexport async function POST(request: NextRequest, { params }: RouteParams) {\n  try {\n    await connectDB();\n    const { id } = await params;\n    console.log(\n      `‚úÖ Database connected for POST /api/leads/${id}/outreach/generate`\n    );\n\n    const leadId = id;\n\n    // Fetch lead with populated data\n    const lead = await Lead.findById(leadId)\n      .populate(\"company_id\")\n      .populate(\"persona_id\");\n\n    if (!lead) {\n      return NextResponse.json(\n        {\n          success: false,\n          error: \"Lead not found\",\n        },\n        { status: 404 }\n      );\n    }\n\n    // Fetch research run and ICP score\n    const researchRun = await ResearchRun.findOne({ lead_id: leadId });\n    const icpScore = await ICPScore.findOne({ lead_id: leadId });\n\n    if (!researchRun || !icpScore) {\n      return NextResponse.json(\n        {\n          success: false,\n          error:\n            \"Research and ICP scoring must be completed before generating outreach\",\n        },\n        { status: 400 }\n      );\n    }\n\n    console.log(\n      `üìã Generating outreach for lead: ${lead.name} (ICP: ${icpScore.icp_score})`\n    );\n\n    // Step 1: Call Outreach Strategy Agent\n    console.log(\"üéØ Calling Outreach Strategy Agent...\");\n\n    // Fetch detected signals\n    const detectedSignals = await DetectedSignal.find({ lead_id: leadId });\n\n    const strategyInput = {\n      lead: {\n        name: lead.name,\n        title: lead.title,\n        email: lead.email,\n      },\n      company: (lead.company_id as any).toObject(),\n      persona: (lead.persona_id as any).toObject(),\n      research: researchRun.research_meta,\n      icp_score: {\n        icp_score: icpScore.icp_score,\n        fit_tier: icpScore.fit_tier,\n        score_breakdown: icpScore.score_breakdown,\n        strengths: icpScore.strengths,\n        risks: icpScore.risks,\n      },\n      detected_signals: detectedSignals.map((s) => s.toObject()),\n    };\n\n    // Generate unique session ID for this strategy run\n    const strategySessionId = `strategy-${leadId}-${Date.now()}`;\n\n    // Call Lyzr API\n    const strategyAgentResponse = await fetch(LYXR_AGENT_API_URL, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        \"x-api-key\": LYXR_API_KEY,\n      },\n      body: JSON.stringify({\n        user_id: USER_ID,\n        agent_id: OUTREACH_STRATEGY_AGENT_ID,\n        session_id: strategySessionId,\n        message: JSON.stringify(strategyInput),\n      }),\n    });\n\n    if (!strategyAgentResponse.ok) {\n      const errorText = await strategyAgentResponse.text();\n      throw new Error(\n        `Strategy Agent API error: ${strategyAgentResponse.status} - ${errorText}`\n      );\n    }\n\n    const strategyAgentData = await strategyAgentResponse.json();\n\n    // Parse the strategy response\n    let strategyOutput;\n    try {\n      if (typeof strategyAgentData.response === \"string\") {\n        strategyOutput = JSON.parse(strategyAgentData.response);\n      } else {\n        strategyOutput = strategyAgentData.response;\n      }\n    } catch (parseError) {\n      console.warn(\n        \"‚ö†Ô∏è Could not parse strategy response as JSON, using raw response\"\n      );\n      strategyOutput = strategyAgentData.response;\n    }\n\n    // Save strategy run\n    const strategyRun = await OutreachStrategyRun.create({\n      lead_id: leadId,\n      research_run_id: researchRun._id,\n      icp_score_id: icpScore._id,\n      strategy_output: {\n        ...strategyOutput,\n        strategy_meta: {\n          ...strategyOutput.strategy_meta,\n          inputs_used: {\n            research_run_id: researchRun._id.toString(),\n            icp_score_id: icpScore._id.toString(),\n          },\n        },\n      },\n    });\n\n    console.log(\n      `‚úÖ Outreach Strategy saved (status: ${strategyOutput.strategy_status})`\n    );\n\n    // Check if strategy blocks outreach\n    if (strategyOutput.strategy_status === \"NO_OUTREACH\") {\n      // Update campaign to reflect no outreach\n      await OutreachCampaign.findOneAndUpdate(\n        { lead_id: leadId },\n        {\n          status: \"disqualified\",\n          final_decision: {\n            status: \"No outreach\",\n            reason: strategyOutput.reason || \"Strategy determined no outreach\",\n          },\n        },\n        { upsert: true }\n      );\n\n      return NextResponse.json(\n        {\n          success: true,\n          message: \"Strategy generated but no outreach recommended\",\n          strategy_status: \"NO_OUTREACH\",\n          reason: strategyOutput.reason,\n        },\n        { status: 200 }\n      );\n    }\n\n    // Step 2: Call Outreach Copy Agent\n    console.log(\"‚úçÔ∏è Calling Outreach Copy Agent...\");\n\n    const copyInput = {\n      lead: {\n        name: lead.name,\n        title: lead.title,\n        email: lead.email,\n      },\n      company: (lead.company_id as any).toObject(),\n      persona: (lead.persona_id as any).toObject(),\n      research: researchRun.research_meta,\n      icp_score: {\n        icp_score: icpScore.icp_score,\n        fit_tier: icpScore.fit_tier,\n      },\n      strategy: strategyOutput,\n      strategy_run_id: strategyRun._id.toString(),\n    };\n\n    // Generate unique session ID for this copy run\n    const copySessionId = `copy-${leadId}-${Date.now()}`;\n\n    // Call Lyzr API\n    const copyAgentResponse = await fetch(LYXR_AGENT_API_URL, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        \"x-api-key\": LYXR_API_KEY,\n      },\n      body: JSON.stringify({\n        user_id: USER_ID,\n        agent_id: OUTREACH_COPY_AGENT_ID,\n        session_id: copySessionId,\n        message: JSON.stringify(copyInput),\n      }),\n    });\n\n    if (!copyAgentResponse.ok) {\n      const errorText = await copyAgentResponse.text();\n      throw new Error(\n        `Copy Agent API error: ${copyAgentResponse.status} - ${errorText}`\n      );\n    }\n\n    const copyAgentData = await copyAgentResponse.json();\n\n    // Parse the copy response\n    let copyOutput;\n    try {\n      if (typeof copyAgentData.response === \"string\") {\n        copyOutput = JSON.parse(copyAgentData.response);\n      } else {\n        copyOutput = copyAgentData.response;\n      }\n    } catch (parseError) {\n      console.warn(\n        \"‚ö†Ô∏è Could not parse copy response as JSON, using raw response\"\n      );\n      copyOutput = copyAgentData.response;\n    }\n\n    // Save copy run\n    const copyRun = await OutreachCopyRun.create({\n      lead_id: leadId,\n      strategy_run_id: strategyRun._id,\n      copy_output: {\n        ...copyOutput,\n        copy_meta: {\n          ...copyOutput.copy_meta,\n          strategy_run_id: strategyRun._id.toString(),\n        },\n      },\n    });\n\n    console.log(`‚úÖ Outreach Copy saved (status: ${copyOutput.status})`);\n\n    // Step 3: Update campaign\n    const totalSteps =\n      strategyOutput.recommended_channel_sequence?.length || 0;\n    const firstStep = strategyOutput.recommended_channel_sequence?.[0];\n\n    await OutreachCampaign.findOneAndUpdate(\n      { lead_id: leadId },\n      {\n        status: \"active\",\n        current_phase: \"Engagement\",\n        current_step_number: 1,\n        next_planned_action: {\n          label: firstStep?.goal || \"Start outreach\",\n          scheduled_at: firstStep?.recommended_delay_hours\n            ? new Date(Date.now() + firstStep.recommended_delay_hours * 3600000)\n            : null,\n        },\n        final_decision: {\n          status: \"In progress\",\n          reason: \"Outreach strategy generated and ready\",\n        },\n      },\n      { upsert: true, new: true }\n    );\n\n    // Step 4: Create initial events\n    const campaign = await OutreachCampaign.findOne({ lead_id: leadId });\n    \n    // Get current max sort_order\n    const lastEvent = await OutreachEvent.findOne({ lead_id: leadId }).sort({\n      sort_order: -1,\n    });\n    let sortOrder = (lastEvent?.sort_order || 0) + 1;\n\n    // Event: Strategy generated\n    await OutreachEvent.create({\n      lead_id: leadId,\n      campaign_id: campaign!._id,\n      event_type: \"decision\",\n      actor: \"AI\",\n      timestamp: new Date(),\n      sort_order: sortOrder++,\n      title: \"Outreach strategy generated\",\n      summary: `AI-generated ${totalSteps}-step outreach strategy with channels: ${strategyOutput.recommended_channel_sequence\n        ?.map((s: any) => s.channel)\n        .join(\", \")}. Strategy confidence: ${strategyOutput.confidence_level}.`,\n      badge: \"AI Decision\",\n      metadata: {\n        strategy_run_id: strategyRun._id,\n        total_steps: totalSteps,\n        channels: strategyOutput.recommended_channel_sequence?.map(\n          (s: any) => s.channel\n        ),\n        confidence: strategyOutput.confidence_level,\n      },\n    });\n\n    // Event: Copy generated\n    await OutreachEvent.create({\n      lead_id: leadId,\n      campaign_id: campaign!._id,\n      event_type: \"outreach\",\n      actor: \"AI\",\n      timestamp: new Date(),\n      sort_order: sortOrder++,\n      title: \"Outreach copy generated\",\n      summary: `AI-generated personalized copy for ${copyOutput.drafts?.length || 0} outreach steps. Copy confidence: ${copyOutput.confidence_level}.`,\n      badge: \"Outreach Prepared\",\n      metadata: {\n        copy_run_id: copyRun._id,\n        drafts_count: copyOutput.drafts?.length || 0,\n        confidence: copyOutput.confidence_level,\n      },\n    });\n\n    // Event: Outreach ready to start\n    await OutreachEvent.create({\n      lead_id: leadId,\n      campaign_id: campaign!._id,\n      event_type: \"lifecycle\",\n      actor: \"System\",\n      timestamp: new Date(),\n      sort_order: sortOrder++,\n      title: \"Outreach campaign ready\",\n      summary: `Campaign configured and ready to execute. Next step: ${firstStep?.goal || \"Begin outreach\"}`,\n      badge: \"Campaign Ready\",\n      metadata: {\n        next_step: firstStep?.goal,\n        scheduled_at: campaign!.next_planned_action.scheduled_at,\n      },\n    });\n\n    console.log(`‚úÖ Outreach campaign generated for lead ${leadId}`);\n\n    return NextResponse.json(\n      {\n        success: true,\n        message: \"Outreach strategy and copy generated successfully\",\n        data: {\n          strategy_status: strategyOutput.strategy_status,\n          copy_status: copyOutput.status,\n          total_steps: totalSteps,\n          campaign_status: \"active\",\n        },\n      },\n      { status: 200 }\n    );\n  } catch (error: any) {\n    console.error(\"‚ùå API Error:\", error);\n    return NextResponse.json(\n      {\n        success: false,\n        error: \"Internal server error\",\n        message: error.message || \"An unexpected error occurred\",\n      },\n      { status: 500 }\n    );\n  }\n}\n\n"],"names":[],"mappings":"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","debugId":null}}]
}