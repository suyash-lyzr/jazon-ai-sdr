{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/suyashmankar/Desktop/LYZR/Jazon%20-%20AI%20SDR/AI-SDR-APP/AI-SDR/src/models/Persona.ts"],"sourcesContent":["import mongoose, { Document, Model, Schema } from \"mongoose\";\n\nexport interface ILocation {\n  city: string;\n  state_or_region: string;\n  country: string;\n  time_zone: string;\n}\n\nexport interface IDecisionAuthority {\n  budget_owner_likelihood: \"High\" | \"Medium\" | \"Low\";\n  decision_maker_likelihood: \"High\" | \"Medium\" | \"Low\";\n  champion_likelihood: \"High\" | \"Medium\" | \"Low\";\n  rationale: string;\n}\n\nexport interface IPersona extends Document {\n  full_name: string;\n  email: string;\n  linkedin_url: string;\n  title: string;\n  seniority: string;\n  department: string;\n  location: ILocation;\n  reports_to: string;\n  decision_authority: IDecisionAuthority;\n  responsibilities: string[];\n  pain_points: string[];\n  confidence: \"High\" | \"Medium\" | \"Low\";\n  createdAt: Date;\n  updatedAt: Date;\n}\n\nconst LocationSchema = new Schema<ILocation>(\n  {\n    city: { type: String, default: \"\" },\n    state_or_region: { type: String, default: \"\" },\n    country: { type: String, default: \"\" },\n    time_zone: { type: String, default: \"\" },\n  },\n  { _id: false }\n);\n\nconst DecisionAuthoritySchema = new Schema<IDecisionAuthority>(\n  {\n    budget_owner_likelihood: {\n      type: String,\n      enum: [\"High\", \"Medium\", \"Low\"],\n      default: \"Low\",\n    },\n    decision_maker_likelihood: {\n      type: String,\n      enum: [\"High\", \"Medium\", \"Low\"],\n      default: \"Low\",\n    },\n    champion_likelihood: {\n      type: String,\n      enum: [\"High\", \"Medium\", \"Low\"],\n      default: \"Low\",\n    },\n    rationale: { type: String, default: \"\" },\n  },\n  { _id: false }\n);\n\nconst PersonaSchema = new Schema<IPersona>(\n  {\n    full_name: {\n      type: String,\n      required: true,\n      index: true,\n    },\n    email: {\n      type: String,\n      index: true,\n      sparse: true,\n      unique: true,\n    },\n    linkedin_url: {\n      type: String,\n      index: true,\n      sparse: true,\n      unique: true,\n    },\n    title: {\n      type: String,\n      default: \"\",\n    },\n    seniority: {\n      type: String,\n      default: \"\",\n    },\n    department: {\n      type: String,\n      default: \"\",\n    },\n    location: {\n      type: LocationSchema,\n      default: () => ({}),\n    },\n    reports_to: {\n      type: String,\n      default: \"\",\n    },\n    decision_authority: {\n      type: DecisionAuthoritySchema,\n      default: () => ({}),\n    },\n    responsibilities: {\n      type: [String],\n      default: [],\n    },\n    pain_points: {\n      type: [String],\n      default: [],\n    },\n    confidence: {\n      type: String,\n      enum: [\"High\", \"Medium\", \"Low\"],\n      default: \"Low\",\n    },\n  },\n  {\n    timestamps: true,\n    collection: \"personas\",\n  }\n);\n\n// Static method for finding or creating a persona\nPersonaSchema.statics.findOrCreate = async function (\n  personaData: Partial<IPersona>\n): Promise<IPersona> {\n  const Persona = this as Model<IPersona>;\n\n  // Try to find by email first (most reliable)\n  if (personaData.email) {\n    const existingByEmail = await Persona.findOne({\n      email: personaData.email.toLowerCase(),\n    });\n    if (existingByEmail) {\n      // Update existing persona with new data if provided\n      Object.assign(existingByEmail, personaData);\n      await existingByEmail.save();\n      return existingByEmail;\n    }\n  }\n\n  // Try to find by LinkedIn URL\n  if (personaData.linkedin_url) {\n    const existingByLinkedIn = await Persona.findOne({\n      linkedin_url: personaData.linkedin_url,\n    });\n    if (existingByLinkedIn) {\n      // Update existing persona with new data if provided\n      Object.assign(existingByLinkedIn, personaData);\n      await existingByLinkedIn.save();\n      return existingByLinkedIn;\n    }\n  }\n\n  // Try to find by name (case-insensitive, less reliable)\n  if (personaData.full_name) {\n    const existingByName = await Persona.findOne({\n      full_name: new RegExp(`^${personaData.full_name}$`, \"i\"),\n    });\n    if (existingByName) {\n      // Update existing persona with new data if provided\n      Object.assign(existingByName, personaData);\n      await existingByName.save();\n      return existingByName;\n    }\n  }\n\n  // Create new persona if not found\n  const newPersona = new Persona(personaData);\n  await newPersona.save();\n  return newPersona;\n};\n\n// Extend the model interface to include statics\ninterface IPersonaModel extends Model<IPersona> {\n  findOrCreate(personaData: Partial<IPersona>): Promise<IPersona>;\n}\n\nconst Persona: IPersonaModel =\n  (mongoose.models.Persona as IPersonaModel) ||\n  mongoose.model<IPersona, IPersonaModel>(\"Persona\", PersonaSchema);\n\nexport default Persona;\n\n"],"names":[],"mappings":";;;;AAAA;;AAiCA,MAAM,iBAAiB,IAAI,mHAAM,CAC/B;IACE,MAAM;QAAE,MAAM;QAAQ,SAAS;IAAG;IAClC,iBAAiB;QAAE,MAAM;QAAQ,SAAS;IAAG;IAC7C,SAAS;QAAE,MAAM;QAAQ,SAAS;IAAG;IACrC,WAAW;QAAE,MAAM;QAAQ,SAAS;IAAG;AACzC,GACA;IAAE,KAAK;AAAM;AAGf,MAAM,0BAA0B,IAAI,mHAAM,CACxC;IACE,yBAAyB;QACvB,MAAM;QACN,MAAM;YAAC;YAAQ;YAAU;SAAM;QAC/B,SAAS;IACX;IACA,2BAA2B;QACzB,MAAM;QACN,MAAM;YAAC;YAAQ;YAAU;SAAM;QAC/B,SAAS;IACX;IACA,qBAAqB;QACnB,MAAM;QACN,MAAM;YAAC;YAAQ;YAAU;SAAM;QAC/B,SAAS;IACX;IACA,WAAW;QAAE,MAAM;QAAQ,SAAS;IAAG;AACzC,GACA;IAAE,KAAK;AAAM;AAGf,MAAM,gBAAgB,IAAI,mHAAM,CAC9B;IACE,WAAW;QACT,MAAM;QACN,UAAU;QACV,OAAO;IACT;IACA,OAAO;QACL,MAAM;QACN,OAAO;QACP,QAAQ;QACR,QAAQ;IACV;IACA,cAAc;QACZ,MAAM;QACN,OAAO;QACP,QAAQ;QACR,QAAQ;IACV;IACA,OAAO;QACL,MAAM;QACN,SAAS;IACX;IACA,WAAW;QACT,MAAM;QACN,SAAS;IACX;IACA,YAAY;QACV,MAAM;QACN,SAAS;IACX;IACA,UAAU;QACR,MAAM;QACN,SAAS,IAAM,CAAC,CAAC,CAAC;IACpB;IACA,YAAY;QACV,MAAM;QACN,SAAS;IACX;IACA,oBAAoB;QAClB,MAAM;QACN,SAAS,IAAM,CAAC,CAAC,CAAC;IACpB;IACA,kBAAkB;QAChB,MAAM;YAAC;SAAO;QACd,SAAS,EAAE;IACb;IACA,aAAa;QACX,MAAM;YAAC;SAAO;QACd,SAAS,EAAE;IACb;IACA,YAAY;QACV,MAAM;QACN,MAAM;YAAC;YAAQ;YAAU;SAAM;QAC/B,SAAS;IACX;AACF,GACA;IACE,YAAY;IACZ,YAAY;AACd;AAGF,kDAAkD;AAClD,cAAc,OAAO,CAAC,YAAY,GAAG,eACnC,WAA8B;IAE9B,MAAM,UAAU,IAAI;IAEpB,6CAA6C;IAC7C,IAAI,YAAY,KAAK,EAAE;QACrB,MAAM,kBAAkB,MAAM,QAAQ,OAAO,CAAC;YAC5C,OAAO,YAAY,KAAK,CAAC,WAAW;QACtC;QACA,IAAI,iBAAiB;YACnB,oDAAoD;YACpD,OAAO,MAAM,CAAC,iBAAiB;YAC/B,MAAM,gBAAgB,IAAI;YAC1B,OAAO;QACT;IACF;IAEA,8BAA8B;IAC9B,IAAI,YAAY,YAAY,EAAE;QAC5B,MAAM,qBAAqB,MAAM,QAAQ,OAAO,CAAC;YAC/C,cAAc,YAAY,YAAY;QACxC;QACA,IAAI,oBAAoB;YACtB,oDAAoD;YACpD,OAAO,MAAM,CAAC,oBAAoB;YAClC,MAAM,mBAAmB,IAAI;YAC7B,OAAO;QACT;IACF;IAEA,wDAAwD;IACxD,IAAI,YAAY,SAAS,EAAE;QACzB,MAAM,iBAAiB,MAAM,QAAQ,OAAO,CAAC;YAC3C,WAAW,IAAI,OAAO,CAAC,CAAC,EAAE,YAAY,SAAS,CAAC,CAAC,CAAC,EAAE;QACtD;QACA,IAAI,gBAAgB;YAClB,oDAAoD;YACpD,OAAO,MAAM,CAAC,gBAAgB;YAC9B,MAAM,eAAe,IAAI;YACzB,OAAO;QACT;IACF;IAEA,kCAAkC;IAClC,MAAM,aAAa,IAAI,QAAQ;IAC/B,MAAM,WAAW,IAAI;IACrB,OAAO;AACT;AAOA,MAAM,UACJ,AAAC,oHAAQ,CAAC,MAAM,CAAC,OAAO,IACxB,oHAAQ,CAAC,KAAK,CAA0B,WAAW;uCAEtC","debugId":null}}]
}