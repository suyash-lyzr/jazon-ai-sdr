{"version":3,"sources":["turbopack:///[project]/src/models/OutreachGuardrails.ts"],"sourcesContent":["import mongoose, { Document, Model, Schema } from \"mongoose\";\n\nexport interface IOutreachGuardrails extends Document {\n  lead_id: mongoose.Types.ObjectId | null; // null = global defaults\n  max_touches: number;\n  voice_escalation_allowed: boolean;\n  voice_escalation_trigger: string;\n  stop_conditions: string[];\n  compliance_rules: string[];\n  createdAt: Date;\n  updatedAt: Date;\n}\n\nconst OutreachGuardrailsSchema = new Schema<IOutreachGuardrails>(\n  {\n    lead_id: {\n      type: Schema.Types.ObjectId,\n      ref: \"Lead\",\n      default: null,\n      index: true,\n    },\n    max_touches: {\n      type: Number,\n      default: 8,\n    },\n    voice_escalation_allowed: {\n      type: Boolean,\n      default: true,\n    },\n    voice_escalation_trigger: {\n      type: String,\n      default: \"High ICP (â‰¥80) + engagement on 2+ channels\",\n    },\n    stop_conditions: {\n      type: [String],\n      default: [\n        \"Explicit opt-out\",\n        \"No engagement after 8 touches\",\n        \"ICP score drops below 40 after re-research\",\n      ],\n    },\n    compliance_rules: {\n      type: [String],\n      default: [\n        \"No weekend outreach (respects business hours)\",\n        \"Unsubscribe links included in all emails\",\n        \"GDPR and CAN-SPAM compliant messaging\",\n      ],\n    },\n  },\n  {\n    timestamps: true,\n    collection: \"outreach_guardrails\",\n  }\n);\n\n// Static method to get guardrails (lead-specific or global)\nOutreachGuardrailsSchema.statics.getForLead = async function (\n  leadId: mongoose.Types.ObjectId\n) {\n  // Try to find lead-specific guardrails\n  let guardrails = await this.findOne({ lead_id: leadId });\n\n  if (!guardrails) {\n    // Fall back to global defaults\n    guardrails = await this.findOne({ lead_id: null });\n\n    if (!guardrails) {\n      // Create global defaults if they don't exist\n      guardrails = await this.create({ lead_id: null });\n    }\n  }\n\n  return guardrails;\n};\n\nconst OutreachGuardrails: Model<IOutreachGuardrails> =\n  mongoose.models.OutreachGuardrails ||\n  mongoose.model<IOutreachGuardrails>(\n    \"OutreachGuardrails\",\n    OutreachGuardrailsSchema\n  );\n\nexport default OutreachGuardrails;\n\n"],"names":[],"mappings":"8DAAA,IAAA,EAAA,EAAA,CAAA,CAAA,OAaA,IAAM,EAA2B,IAAI,EAAA,MAAM,CACzC,CACE,QAAS,CACP,KAAM,EAAA,MAAM,CAAC,KAAK,CAAC,QAAQ,CAC3B,IAAK,OACL,QAAS,KACT,OAAO,CACT,EACA,YAAa,CACX,KAAM,OACN,QAAS,CACX,EACA,yBAA0B,CACxB,KAAM,QACN,SAAS,CACX,EACA,yBAA0B,CACxB,KAAM,OACN,QAAS,4CACX,EACA,gBAAiB,CACf,KAAM,CAAC,OAAO,CACd,QAAS,CACP,mBACA,gCACA,6CAEJ,AADG,EAEH,iBAAkB,CAChB,KAAM,CAAC,OAAO,CACd,QAAS,CACP,gDACA,2CACA,wCACD,AACH,CACF,EACA,CACE,YAAY,EACZ,WAAY,qBACd,GAIF,EAAyB,OAAO,CAAC,UAAU,CAAG,eAC5C,CAA+B,EAG/B,IAAI,EAAa,MAAM,IAAI,CAAC,OAAO,CAAC,CAAE,QAAS,CAAO,GAYtD,MAVI,CAAC,GAIC,CAAC,CAFL,EAAa,KAFE,CAEI,IAAI,CAAC,OAAO,CAAC,CAAE,QAAS,IAAK,EAAA,IAI9C,EAAa,MAAM,IAAI,CAAC,MAAM,CAAC,CAAE,QAAS,IAAK,EAAA,CAF5C,EAMA,CANY,AAOrB,QAGE,EAAA,OAAQ,CAAC,MAAM,CAAC,cAMH,IANqB,EAClC,EAAA,OAAQ,CAAC,KAAK,CACZ,qBACA"}