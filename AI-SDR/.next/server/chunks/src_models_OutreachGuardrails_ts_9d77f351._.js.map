{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/suyashmankar/Desktop/LYZR/Jazon%20-%20AI%20SDR/AI-SDR-APP/AI-SDR/src/models/OutreachGuardrails.ts"],"sourcesContent":["import mongoose, { Document, Model, Schema } from \"mongoose\";\n\nexport interface IOutreachGuardrails extends Document {\n  lead_id: mongoose.Types.ObjectId | null; // null = global defaults\n  max_touches: number;\n  voice_escalation_allowed: boolean;\n  voice_escalation_trigger: string;\n  stop_conditions: string[];\n  compliance_rules: string[];\n  createdAt: Date;\n  updatedAt: Date;\n}\n\nconst OutreachGuardrailsSchema = new Schema<IOutreachGuardrails>(\n  {\n    lead_id: {\n      type: Schema.Types.ObjectId,\n      ref: \"Lead\",\n      default: null,\n      index: true,\n    },\n    max_touches: {\n      type: Number,\n      default: 8,\n    },\n    voice_escalation_allowed: {\n      type: Boolean,\n      default: true,\n    },\n    voice_escalation_trigger: {\n      type: String,\n      default: \"High ICP (â‰¥80) + engagement on 2+ channels\",\n    },\n    stop_conditions: {\n      type: [String],\n      default: [\n        \"Explicit opt-out\",\n        \"No engagement after 8 touches\",\n        \"ICP score drops below 40 after re-research\",\n      ],\n    },\n    compliance_rules: {\n      type: [String],\n      default: [\n        \"No weekend outreach (respects business hours)\",\n        \"Unsubscribe links included in all emails\",\n        \"GDPR and CAN-SPAM compliant messaging\",\n      ],\n    },\n  },\n  {\n    timestamps: true,\n    collection: \"outreach_guardrails\",\n  }\n);\n\n// Static method to get guardrails (lead-specific or global)\nOutreachGuardrailsSchema.statics.getForLead = async function (\n  leadId: mongoose.Types.ObjectId\n) {\n  // Try to find lead-specific guardrails\n  let guardrails = await this.findOne({ lead_id: leadId });\n\n  if (!guardrails) {\n    // Fall back to global defaults\n    guardrails = await this.findOne({ lead_id: null });\n\n    if (!guardrails) {\n      // Create global defaults if they don't exist\n      guardrails = await this.create({ lead_id: null });\n    }\n  }\n\n  return guardrails;\n};\n\nconst OutreachGuardrails: Model<IOutreachGuardrails> =\n  mongoose.models.OutreachGuardrails ||\n  mongoose.model<IOutreachGuardrails>(\n    \"OutreachGuardrails\",\n    OutreachGuardrailsSchema\n  );\n\nexport default OutreachGuardrails;\n\n"],"names":[],"mappings":";;;;AAAA;;AAaA,MAAM,2BAA2B,IAAI,mHAAM,CACzC;IACE,SAAS;QACP,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,SAAS;QACT,OAAO;IACT;IACA,aAAa;QACX,MAAM;QACN,SAAS;IACX;IACA,0BAA0B;QACxB,MAAM;QACN,SAAS;IACX;IACA,0BAA0B;QACxB,MAAM;QACN,SAAS;IACX;IACA,iBAAiB;QACf,MAAM;YAAC;SAAO;QACd,SAAS;YACP;YACA;YACA;SACD;IACH;IACA,kBAAkB;QAChB,MAAM;YAAC;SAAO;QACd,SAAS;YACP;YACA;YACA;SACD;IACH;AACF,GACA;IACE,YAAY;IACZ,YAAY;AACd;AAGF,4DAA4D;AAC5D,yBAAyB,OAAO,CAAC,UAAU,GAAG,eAC5C,MAA+B;IAE/B,uCAAuC;IACvC,IAAI,aAAa,MAAM,IAAI,CAAC,OAAO,CAAC;QAAE,SAAS;IAAO;IAEtD,IAAI,CAAC,YAAY;QACf,+BAA+B;QAC/B,aAAa,MAAM,IAAI,CAAC,OAAO,CAAC;YAAE,SAAS;QAAK;QAEhD,IAAI,CAAC,YAAY;YACf,6CAA6C;YAC7C,aAAa,MAAM,IAAI,CAAC,MAAM,CAAC;gBAAE,SAAS;YAAK;QACjD;IACF;IAEA,OAAO;AACT;AAEA,MAAM,qBACJ,oHAAQ,CAAC,MAAM,CAAC,kBAAkB,IAClC,oHAAQ,CAAC,KAAK,CACZ,sBACA;uCAGW","debugId":null}}]
}